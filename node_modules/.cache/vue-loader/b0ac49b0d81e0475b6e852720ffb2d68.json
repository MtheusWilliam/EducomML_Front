{"remainingRequest":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\www\\EducomML\\EducomML_Front\\src\\components\\instructional_model\\ProcedureDialog.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\www\\EducomML\\EducomML_Front\\src\\components\\instructional_model\\ProcedureDialog.vue","mtime":1597817196853},{"path":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1597353521000},{"path":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\babel-loader\\lib\\index.js","mtime":1597353521000},{"path":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\vuetify-loader\\lib\\loader.js","mtime":1597353521000},{"path":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1597353521000},{"path":"C:\\www\\EducomML\\EducomML_Front\\node_modules\\vue-loader\\lib\\index.js","mtime":1597353521000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBBcGkgZnJvbSAiQC9zZXJ2aWNlcy9BcGkiOwppbXBvcnQgKiBhcyBmaXJlYmFzZSBmcm9tICJmaXJlYmFzZSI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIlByb2NlZHVyZURpYWxvZyIsCiAgcHJvcHM6IFsiZGlhbG9nIiwgInByb2NlZHVyZSIsICJjb25jZXB0IiwgIm1vZHVsZSIsICJkb21haW4iXSwKICBkYXRhOiAoKSA9PiAoewogICAgdmFsaWQ6IHRydWUsCiAgICBkaWFsb2dfYWxlcnQ6IGZhbHNlLAogICAgYXV4SXRlbUluZm86ICIiLAogICAgcGhhc2VzQ29udHJvbDogW10sCiAgICBsaW5rVXJsUnVsZXM6IFsodikgPT4gISF2IHx8ICLDiSBuZWNlc3PDoXJpbyBpbnNlcmlyIGEgdXJsIGRvIHNldSBsaW5rIl0sCiAgICBwaGFzZXNDb250cm9sUnVsZXM6IFsKICAgICAgKHYpID0+CiAgICAgICAgISF2IHx8CiAgICAgICAgIsOJIG5lY2Vzc8OhcmlvIGluc2VyaXIgYWxndW0gY29udGXDumRvIG5lc3NhIGV0YXBhIGRvIHByb2NlZGltZW50byIsCiAgICBdLAogICAgcHJvY2VkdXJlTmFtZTogIiIsCiAgICBwcm9jZWR1cmVOYW1lUnVsZXM6IFsKICAgICAgKHYpID0+ICEhdiB8fCAiw4kgbmVjZXNzw6FyaW8gZGVzY3JldmVyIG8gbm9tZSBkbyBwcm9jZWRpbWVudG8iLAogICAgICAodikgPT4KICAgICAgICAodiAmJiB2Lmxlbmd0aCA8PSAxMDApIHx8CiAgICAgICAgIk5vbWUgZG8gcHJvY2VkaW1lbnRvIGRldmUgdGVyIG5vIG3DoXhpbW8gMjUgY2FyYWN0ZXJlcyIsCiAgICBdLAogICAgcHJvY2VkdXJlRGVzY3JpcHRpb246ICIiLAogICAgcHJvY2VkdXJlRGVzY3JpcHRpb25SdWxlczogWwogICAgICAodikgPT4KICAgICAgICAhIXYgfHwKICAgICAgICAiw4kgbmVjZXNzw6FyaW8gaW5zZXJpciB1bWEgZGVzY3Jpw6fDo28gZG8gcHJvY2VkaW1lbnRvIGEgc2VyIGluc2VyaWRvIiwKICAgIF0sCiAgICBtb2JpbGVNZWRpYXNDb250cm9sOiBbXSwKICAgIGl0ZW1zTW9iaWxlTWVkaWE6IFsKICAgICAgewogICAgICAgIGljb246ICJtZGktZmlsZS1pbWFnZSIsCiAgICAgICAgbmFtZTogIkltYWdlbSIsCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpY29uOiAibWRpLWZpbGUtdmlkZW8iLAogICAgICAgIG5hbWU6ICJWaWRlbyIsCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpY29uOiAibWRpLWZpbGUtbXVzaWMiLAogICAgICAgIG5hbWU6ICJBdWRpbyIsCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpY29uOiAibWRpLWxpbmstdmFyaWFudCIsCiAgICAgICAgbmFtZTogIkxpbmsiLAogICAgICB9LAogICAgXSwKICB9KSwKICB3YXRjaDogewogICAgZGlhbG9nOiBmdW5jdGlvbiAoKSB7CiAgICAgIHRoaXMuZ2V0UHJvY2VkdXJlKCk7CiAgICB9LAogIH0sCiAgbW91bnRlZDogZnVuY3Rpb24gKCkgewogICAgdGhpcy5nZXRQcm9jZWR1cmUoKTsKICAgIHRoaXMuJHJlZnMuZm9ybS5yZXNldFZhbGlkYXRpb24oKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIGFzeW5jIGdldFByb2NlZHVyZSgpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdGhpcy4kbmV4dFRpY2soZnVuY3Rpb24gKCkgewogICAgICAgIHZtLnByb2NlZHVyZU5hbWUgPSB2bS5wcm9jZWR1cmUubmFtZWluZm9ybWF0aW9uaXRlbTsKICAgICAgICB2bS5wcm9jZWR1cmVEZXNjcmlwdGlvbiA9IHZtLnByb2NlZHVyZS5kZXNjcmlwdGlvbmluZm9ybWF0aW9uaXRlbTsKICAgICAgfSk7CiAgICAgIHRoaXMucGhhc2VzQ29udHJvbCA9IFtdOwogICAgICB0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2wgPSBbXTsKICAgICAgaWYgKHRoaXMucHJvY2VkdXJlICE9PSAiIikgewogICAgICAgIHRoaXMucHJvY2VkdXJlLnBoYXNlcHJvY2VkdXJlcy5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uICgKICAgICAgICAgIHBoYXNlLAogICAgICAgICAgaW5kZXhQaGFzZQogICAgICAgICkgewogICAgICAgICAgYXdhaXQgdm0ucGhhc2VzQ29udHJvbC5wdXNoKHsKICAgICAgICAgICAgZGVzY3JpcHRpb246IHBoYXNlLmRlc2NyaXB0aW9uLAogICAgICAgICAgICBtb2JpbGVNZWRpYXM6IFtdLAogICAgICAgICAgICB1cmw6IHBoYXNlLnVybCwKICAgICAgICAgIH0pOwogICAgICAgICAgaWYgKHBoYXNlLm1vYmlsZW1lZGlhcykgewogICAgICAgICAgICBhd2FpdCBwaGFzZS5tb2JpbGVtZWRpYXMuZm9yRWFjaChhc3luYyBmdW5jdGlvbiAoCiAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZSwKICAgICAgICAgICAgICBpbmRleE1vYmlsZQogICAgICAgICAgICApIHsKICAgICAgICAgICAgICBpZiAoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdID09PSAiMSIpIHsKICAgICAgICAgICAgICAgIHZtLmdldFNyY0ltYWdlUGhhc2VzKAogICAgICAgICAgICAgICAgICBpbmRleFBoYXNlLAogICAgICAgICAgICAgICAgICBpbmRleE1vYmlsZSwKICAgICAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICBlbGVtZW50TW9iaWxlLm5hbWVmaWxlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYXdhaXQgdm0ucGhhc2VzQ29udHJvbFtpbmRleFBoYXNlXS5tb2JpbGVNZWRpYXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IHBhcnNlSW50KGVsZW1lbnRNb2JpbGUuZmtfaWRtZWRpYXR5cGUuc3BsaXQoIi8iKVs0XSksCiAgICAgICAgICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogZWxlbWVudE1vYmlsZS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICBwYXRoOiBlbGVtZW50TW9iaWxlLnBhdGgsCiAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBlbGVtZW50TW9iaWxlLm5hbWVmaWxlLAogICAgICAgICAgICAgICAgICB1cmw6IGVsZW1lbnRNb2JpbGUudXJsLAogICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50TW9iaWxlLmZrX2lkbWVkaWF0eXBlLnNwbGl0KCIvIilbNF0gPT09ICIyIikgewogICAgICAgICAgICAgICAgdm0uZ2V0U3JjVmlkZW9RdWVzdGlvbnMoCiAgICAgICAgICAgICAgICAgIGluZGV4UGhhc2UsCiAgICAgICAgICAgICAgICAgIGluZGV4TW9iaWxlLAogICAgICAgICAgICAgICAgICBlbGVtZW50TW9iaWxlLnBhdGgsCiAgICAgICAgICAgICAgICAgIGVsZW1lbnRNb2JpbGUubmFtZWZpbGUKICAgICAgICAgICAgICAgICk7CiAgICAgICAgICAgICAgICBhd2FpdCB2bS5waGFzZXNDb250cm9sW2luZGV4UGhhc2VdLm1vYmlsZU1lZGlhcy5wdXNoKHsKICAgICAgICAgICAgICAgICAgdHlwZTogcGFyc2VJbnQoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdKSwKICAgICAgICAgICAgICAgICAgb2JqZWN0OiBudWxsLAogICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBlbGVtZW50TW9iaWxlLnJlc29sdXRpb24sCiAgICAgICAgICAgICAgICAgIHRpbWU6IGVsZW1lbnRNb2JpbGUudGltZSwKICAgICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5uYW1lZmlsZSwKICAgICAgICAgICAgICAgICAgdXJsOiBlbGVtZW50TW9iaWxlLnVybCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdID09PSAiMyIpIHsKICAgICAgICAgICAgICAgIHZtLmdldFNyY0F1ZGlvUXVlc3Rpb25zKAogICAgICAgICAgICAgICAgICBpbmRleFBoYXNlLAogICAgICAgICAgICAgICAgICBpbmRleE1vYmlsZSwKICAgICAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICBlbGVtZW50TW9iaWxlLm5hbWVmaWxlCiAgICAgICAgICAgICAgICApOwogICAgICAgICAgICAgICAgYXdhaXQgdm0ucGhhc2VzQ29udHJvbFtpbmRleFBoYXNlXS5tb2JpbGVNZWRpYXMucHVzaCh7CiAgICAgICAgICAgICAgICAgIHR5cGU6IHBhcnNlSW50KGVsZW1lbnRNb2JpbGUuZmtfaWRtZWRpYXR5cGUuc3BsaXQoIi8iKVs0XSksCiAgICAgICAgICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5uYW1lZmlsZSwKICAgICAgICAgICAgICAgICAgdXJsOiBlbGVtZW50TW9iaWxlLnVybCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdID09PSAiNSIpIHsKICAgICAgICAgICAgICAgIGF3YWl0IHZtLnBoYXNlc0NvbnRyb2xbaW5kZXhQaGFzZV0ubW9iaWxlTWVkaWFzLnB1c2goewogICAgICAgICAgICAgICAgICB0eXBlOiBwYXJzZUludChlbGVtZW50TW9iaWxlLmZrX2lkbWVkaWF0eXBlLnNwbGl0KCIvIilbNF0pLAogICAgICAgICAgICAgICAgICBvYmplY3Q6IGVsZW1lbnRNb2JpbGUudXJsbGluaywKICAgICAgICAgICAgICAgICAgdXJsOiBlbGVtZW50TW9iaWxlLnVybCwKICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfSk7CgogICAgICAgIGF3YWl0IHRoaXMucHJvY2VkdXJlLm1vYmlsZW1lZGlhcy5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uICgKICAgICAgICAgIGVsZW1lbnRNb2JpbGUsCiAgICAgICAgICBpbmRleE1vYmlsZQogICAgICAgICkgewogICAgICAgICAgaWYgKGVsZW1lbnRNb2JpbGUuZmtfaWRtZWRpYXR5cGUuc3BsaXQoIi8iKVs0XSA9PT0gIjEiKSB7CiAgICAgICAgICAgIHZtLmdldFNyY0ltYWdlKAogICAgICAgICAgICAgIGluZGV4TW9iaWxlLAogICAgICAgICAgICAgIGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICBlbGVtZW50TW9iaWxlLm5hbWVmaWxlCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIGF3YWl0IHZtLm1vYmlsZU1lZGlhc0NvbnRyb2wucHVzaCh7CiAgICAgICAgICAgICAgdHlwZTogcGFyc2VJbnQoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdKSwKICAgICAgICAgICAgICBvYmplY3Q6IG51bGwsCiAgICAgICAgICAgICAgcmVzb2x1dGlvbjogZWxlbWVudE1vYmlsZS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5uYW1lZmlsZSwKICAgICAgICAgICAgICB1cmw6IGVsZW1lbnRNb2JpbGUudXJsLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdID09PSAiMiIpIHsKICAgICAgICAgICAgdm0uZ2V0U3JjVmlkZW8oCiAgICAgICAgICAgICAgaW5kZXhNb2JpbGUsCiAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgIGVsZW1lbnRNb2JpbGUubmFtZWZpbGUKICAgICAgICAgICAgKTsKICAgICAgICAgICAgYXdhaXQgdm0ubW9iaWxlTWVkaWFzQ29udHJvbC5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiBwYXJzZUludChlbGVtZW50TW9iaWxlLmZrX2lkbWVkaWF0eXBlLnNwbGl0KCIvIilbNF0pLAogICAgICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgICAgICByZXNvbHV0aW9uOiBlbGVtZW50TW9iaWxlLnJlc29sdXRpb24sCiAgICAgICAgICAgICAgdGltZTogZWxlbWVudE1vYmlsZS50aW1lLAogICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5uYW1lZmlsZSwKICAgICAgICAgICAgICB1cmw6IGVsZW1lbnRNb2JpbGUudXJsLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdID09PSAiMyIpIHsKICAgICAgICAgICAgdm0uZ2V0U3JjQXVkaW8oCiAgICAgICAgICAgICAgaW5kZXhNb2JpbGUsCiAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgIGVsZW1lbnRNb2JpbGUubmFtZWZpbGUKICAgICAgICAgICAgKTsKICAgICAgICAgICAgYXdhaXQgdm0ubW9iaWxlTWVkaWFzQ29udHJvbC5wdXNoKHsKICAgICAgICAgICAgICB0eXBlOiBwYXJzZUludChlbGVtZW50TW9iaWxlLmZrX2lkbWVkaWF0eXBlLnNwbGl0KCIvIilbNF0pLAogICAgICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgICAgICBwYXRoOiBlbGVtZW50TW9iaWxlLnBhdGgsCiAgICAgICAgICAgICAgbmFtZWZpbGU6IGVsZW1lbnRNb2JpbGUubmFtZWZpbGUsCiAgICAgICAgICAgICAgdXJsOiBlbGVtZW50TW9iaWxlLnVybCwKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9IGVsc2UgaWYgKGVsZW1lbnRNb2JpbGUuZmtfaWRtZWRpYXR5cGUuc3BsaXQoIi8iKVs0XSA9PT0gIjUiKSB7CiAgICAgICAgICAgIGF3YWl0IHZtLm1vYmlsZU1lZGlhc0NvbnRyb2wucHVzaCh7CiAgICAgICAgICAgICAgdHlwZTogcGFyc2VJbnQoZWxlbWVudE1vYmlsZS5ma19pZG1lZGlhdHlwZS5zcGxpdCgiLyIpWzRdKSwKICAgICAgICAgICAgICBvYmplY3Q6IGVsZW1lbnRNb2JpbGUudXJsbGluaywKICAgICAgICAgICAgICB1cmw6IGVsZW1lbnRNb2JpbGUudXJsLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGFsdGVyYV9DcmlhX1Byb2NlZGltZW50bygpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgaWYgKHRoaXMucHJvY2VkdXJlID09PSAiIikgewogICAgICAgIGF3YWl0IEFwaSgpCiAgICAgICAgICAucG9zdChgL2luZm9ybWF0aW9uaXRlbS9gLCB7CiAgICAgICAgICAgIG5hbWVpbmZvcm1hdGlvbml0ZW06IHRoaXMucHJvY2VkdXJlTmFtZSwKICAgICAgICAgICAgZGVzY3JpcHRpb25pbmZvcm1hdGlvbml0ZW06IHRoaXMucHJvY2VkdXJlRGVzY3JpcHRpb24sCiAgICAgICAgICAgIGZrX2luZm9ybWF0aW9uaXRlbXR5cGU6IGAvaW5mb3JtYXRpb25pdGVtdHlwZS80L2AsCiAgICAgICAgICAgIGZrX2lkY29uY2VwdDogdGhpcy5jb25jZXB0LnVybCwKICAgICAgICAgICAgdmlzaWJsZTogdHJ1ZSwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbihhc3luYyBmdW5jdGlvbiAocmVzcG9zdGEpIHsKICAgICAgICAgICAgdm0uYXV4SXRlbUluZm8gPSByZXNwb3N0YS5kYXRhLnVybDsKICAgICAgICAgICAgdmFyIGF1eFBhdGggPSAiIjsKICAgICAgICAgICAgaWYgKHZtLm1vYmlsZU1lZGlhc0NvbnRyb2wpIHsKICAgICAgICAgICAgICBhd2FpdCB2bS5tb2JpbGVNZWRpYXNDb250cm9sLmZvckVhY2goYXN5bmMgKG1vYmlsZW1lZGlhKSA9PiB7CiAgICAgICAgICAgICAgICBpZiAobW9iaWxlbWVkaWEudXJsKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS50eXBlICE9PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgZmlyZWJhc2UKICAgICAgICAgICAgICAgICAgICAgIC5zdG9yYWdlKCkKICAgICAgICAgICAgICAgICAgICAgIC5yZWYoKQogICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKG1vYmlsZW1lZGlhLnBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAucHV0KG1vYmlsZW1lZGlhLm9iamVjdCk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgICAgIGF1eFBhdGggPQogICAgICAgICAgICAgICAgICAgIHZtLmRvbWFpbi5pZGtub3dsZWRnZWRvbWFpbi50b1N0cmluZygpICsKICAgICAgICAgICAgICAgICAgICAiLyIgKwogICAgICAgICAgICAgICAgICAgIChhd2FpdCBzZXRUaW1lb3V0KGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IERhdGUubm93KCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgICAgICB9LCAxKSk7CiAgICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS50eXBlICE9PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgZmlyZWJhc2UKICAgICAgICAgICAgICAgICAgICAgIC5zdG9yYWdlKCkKICAgICAgICAgICAgICAgICAgICAgIC5yZWYoKQogICAgICAgICAgICAgICAgICAgICAgLmNoaWxkKGF1eFBhdGgpCiAgICAgICAgICAgICAgICAgICAgICAucHV0KG1vYmlsZW1lZGlhLm9iamVjdCk7CgogICAgICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLnBhdGggPSBhdXhQYXRoOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgaWYgKHZtLm1vYmlsZU1lZGlhc0NvbnRyb2wpIHsKICAgICAgICAgICAgICB2YXIgaSA9IDA7CiAgICAgICAgICAgICAgYXdhaXQgdm0ubW9iaWxlTWVkaWFzQ29udHJvbC5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uICgKICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLAogICAgICAgICAgICAgICAgaW5kZXhtb2JpbGUKICAgICAgICAgICAgICApIHsKICAgICAgICAgICAgICAgIC8qIERBTkRPIFBVVCBOT1MgTU9CSUxFTUVESUFTIFFVRSBQT1NTVUVNIFVSTCovCiAgICAgICAgICAgICAgICBpZiAobW9iaWxlbWVkaWEudXJsKSB7CiAgICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXBpKCkucHV0KG1vYmlsZW1lZGlhLnVybCwgewogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJJbWFnZW0gIiArIChpbmRleG1vYmlsZSArIDEpLAogICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6ICIvbWVkaWF0eXBlLyIgKyBtb2JpbGVtZWRpYS50eXBlICsgIi8iLAogICAgICAgICAgICAgICAgICAgICAgcGF0aDogbW9iaWxlbWVkaWEucGF0aCwKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdXRpb246IG1vYmlsZW1lZGlhLnJlc29sdXRpb24sCiAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogbW9iaWxlbWVkaWEubmFtZWZpbGUsCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgIkltYWdlbSAiICsKICAgICAgICAgICAgICAgICAgICAgICAgKGluZGV4bW9iaWxlICsgMSkgKwogICAgICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgICAgICByZXNwb3N0YS5kYXRhLmxhYmVsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pbmZvcm1hdGlvbml0ZW06IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQobW9iaWxlbWVkaWEudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIlZpZGVvICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG1vYmlsZW1lZGlhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBtb2JpbGVtZWRpYS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG1vYmlsZW1lZGlhLm5hbWVmaWxlLAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBtb2JpbGVtZWRpYS50aW1lLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdTdHlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZrX2luZm9ybWF0aW9uaXRlbTogcmVzcG9zdGEuZGF0YS51cmwsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9iaWxlbWVkaWEudHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnB1dChtb2JpbGVtZWRpYS51cmwsIHsKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiQXVkaW8gIiArIChpbmRleG1vYmlsZSArIDEpLAogICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6ICIvbWVkaWF0eXBlLyIgKyBtb2JpbGVtZWRpYS50eXBlICsgIi8iLAogICAgICAgICAgICAgICAgICAgICAgcGF0aDogbW9iaWxlbWVkaWEucGF0aCwKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdXRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogbW9iaWxlbWVkaWEubmFtZWZpbGUsCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHVybGxpbms6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZmtfaW5mb3JtYXRpb25pdGVtOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXBpKCkucHV0KG1vYmlsZW1lZGlhLnVybCwgewogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJMaW5rICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHVybGxpbms6IG1vYmlsZW1lZGlhLm9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pbmZvcm1hdGlvbml0ZW06IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvKiBEQU5ETyBQT1NUIE5PUyBNT0JJTEVNRURJQVMgUVVFIE7Dg08gUE9TU1VFTSBVUkwqLwogICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhtb2JpbGVtZWRpYSk7CiAgICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImFzZGZzZGZzZCIpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnBvc3QoYC9tb2JpbGVtZWRpYS9gLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkltYWdlbSAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBtb2JpbGVtZWRpYS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbW9iaWxlbWVkaWEucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBtb2JpbGVtZWRpYS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgIkltYWdlbSAiICsKICAgICAgICAgICAgICAgICAgICAgICAgKGluZGV4bW9iaWxlICsgMSkgKwogICAgICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgICAgICByZXNwb3N0YS5kYXRhLmxhYmVsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pbmZvcm1hdGlvbml0ZW06IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygiaSIsIGkpOwogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnBvc3QoYC9tb2JpbGVtZWRpYS9gLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIlZpZGVvICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG1vYmlsZW1lZGlhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBtb2JpbGVtZWRpYS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG1vYmlsZW1lZGlhLnBhdGguc3BsaXQoIi8iKVsxXSwKICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbW9iaWxlbWVkaWEudGltZSwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pbmZvcm1hdGlvbml0ZW06IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wb3N0KGAvbW9iaWxlbWVkaWEvYCwgewogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJBdWRpbyAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBtb2JpbGVtZWRpYS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBtb2JpbGVtZWRpYS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHVybGxpbms6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZmtfaW5mb3JtYXRpb25pdGVtOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXBpKCkucG9zdChgL21vYmlsZW1lZGlhL2AsIHsKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiTGluayAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBtb2JpbGVtZWRpYS5vYmplY3QsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZmtfaW5mb3JtYXRpb25pdGVtOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBhd2FpdCBBcGkoKQogICAgICAgICAgLnB1dChgL2luZm9ybWF0aW9uaXRlbS9gICsgdGhpcy5wcm9jZWR1cmUuaWRpbmZvcm1hdGlvbml0ZW0gKyBgL2AsIHsKICAgICAgICAgICAgbmFtZWluZm9ybWF0aW9uaXRlbTogdGhpcy5wcm9jZWR1cmVOYW1lLAogICAgICAgICAgICBkZXNjcmlwdGlvbmluZm9ybWF0aW9uaXRlbTogdGhpcy5wcm9jZWR1cmVEZXNjcmlwdGlvbiwKICAgICAgICAgICAgZmtfaW5mb3JtYXRpb25pdGVtdHlwZTogYC9pbmZvcm1hdGlvbml0ZW10eXBlLzQvYCwKICAgICAgICAgICAgZmtfaWRjb25jZXB0OiB0aGlzLmNvbmNlcHQudXJsLAogICAgICAgICAgfSkKICAgICAgICAgIC50aGVuKGFzeW5jIGZ1bmN0aW9uIChyZXNwb3N0YSkgewogICAgICAgICAgICB2bS5hdXhJdGVtSW5mbyA9IHJlc3Bvc3RhLmRhdGEudXJsOwogICAgICAgICAgICB2YXIgYXV4UGF0aCA9ICIiOwogICAgICAgICAgICBpZiAodm0ubW9iaWxlTWVkaWFzQ29udHJvbCkgewogICAgICAgICAgICAgIGF3YWl0IHZtLm1vYmlsZU1lZGlhc0NvbnRyb2wuZm9yRWFjaChhc3luYyAobW9iaWxlbWVkaWEpID0+IHsKICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS51cmwpIHsKICAgICAgICAgICAgICAgICAgaWYgKG1vYmlsZW1lZGlhLnR5cGUgIT09IDUpIHsKICAgICAgICAgICAgICAgICAgICBmaXJlYmFzZQogICAgICAgICAgICAgICAgICAgICAgLnN0b3JhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgLnJlZigpCiAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQobW9iaWxlbWVkaWEucGF0aCkKICAgICAgICAgICAgICAgICAgICAgIC5wdXQobW9iaWxlbWVkaWEub2JqZWN0KTsKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgYXV4UGF0aCA9CiAgICAgICAgICAgICAgICAgICAgdm0uZG9tYWluLmlka25vd2xlZGdlZG9tYWluLnRvU3RyaW5nKCkgKwogICAgICAgICAgICAgICAgICAgICIvIiArCiAgICAgICAgICAgICAgICAgICAgKGF3YWl0IHNldFRpbWVvdXQoYXN5bmMgZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgICAgYXdhaXQgRGF0ZS5ub3coKS50b1N0cmluZygpOwogICAgICAgICAgICAgICAgICAgIH0sIDEpKTsKICAgICAgICAgICAgICAgICAgaWYgKG1vYmlsZW1lZGlhLnR5cGUgIT09IDUpIHsKICAgICAgICAgICAgICAgICAgICBmaXJlYmFzZQogICAgICAgICAgICAgICAgICAgICAgLnN0b3JhZ2UoKQogICAgICAgICAgICAgICAgICAgICAgLnJlZigpCiAgICAgICAgICAgICAgICAgICAgICAuY2hpbGQoYXV4UGF0aCkKICAgICAgICAgICAgICAgICAgICAgIC5wdXQobW9iaWxlbWVkaWEub2JqZWN0KTsKCiAgICAgICAgICAgICAgICAgICAgbW9iaWxlbWVkaWEucGF0aCA9IGF1eFBhdGg7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBpZiAodm0ubW9iaWxlTWVkaWFzQ29udHJvbCkgewogICAgICAgICAgICAgIHZhciBpID0gMDsKICAgICAgICAgICAgICBhd2FpdCB2bS5tb2JpbGVNZWRpYXNDb250cm9sLmZvckVhY2goYXN5bmMgZnVuY3Rpb24gKAogICAgICAgICAgICAgICAgbW9iaWxlbWVkaWEsCiAgICAgICAgICAgICAgICBpbmRleG1vYmlsZQogICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgLyogREFORE8gUFVUIE5PUyBNT0JJTEVNRURJQVMgUVVFIFBPU1NVRU0gVVJMKi8KICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKG1vYmlsZW1lZGlhKTsKICAgICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS51cmwpIHsKICAgICAgICAgICAgICAgICAgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQobW9iaWxlbWVkaWEudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkltYWdlbSAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBtb2JpbGVtZWRpYS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbW9iaWxlbWVkaWEucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBtb2JpbGVtZWRpYS5uYW1lZmlsZSwKICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAiSW1hZ2VtICIgKwogICAgICAgICAgICAgICAgICAgICAgICAoaW5kZXhtb2JpbGUgKyAxKSArCiAgICAgICAgICAgICAgICAgICAgICAgICIgIiArCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Bvc3RhLmRhdGEubGFiZWwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdTdHlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZrX2luZm9ybWF0aW9uaXRlbTogcmVzcG9zdGEuZGF0YS51cmwsCiAgICAgICAgICAgICAgICAgICAgICB2aXNpYmxlOiB0cnVlLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQobW9iaWxlbWVkaWEudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIlZpZGVvICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG1vYmlsZW1lZGlhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBtb2JpbGVtZWRpYS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG1vYmlsZW1lZGlhLm5hbWVmaWxlLAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBtb2JpbGVtZWRpYS50aW1lLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdTdHlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkaW5zdHJ1Y3Rpb25hbGVsZW1lbnQ6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDMpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQobW9iaWxlbWVkaWEudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkF1ZGlvICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG1vYmlsZW1lZGlhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG1vYmlsZW1lZGlhLm5hbWVmaWxlLAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdTdHlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkaW5zdHJ1Y3Rpb25hbGVsZW1lbnQ6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDUpIHsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQobW9iaWxlbWVkaWEudXJsLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkxpbmsgIiArIChpbmRleG1vYmlsZSArIDEpLAogICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6ICIvbWVkaWF0eXBlLyIgKyBtb2JpbGVtZWRpYS50eXBlICsgIi8iLAogICAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHJlc29sdXRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbW9iaWxlbWVkaWEub2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbGVhcm5pbmdTdHlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkaW5zdHJ1Y3Rpb25hbGVsZW1lbnQ6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAvKiBEQU5ETyBQT1NUIE5PUyBNT0JJTEVNRURJQVMgUVVFIE7Dg08gUE9TU1VFTSBVUkwqLwogICAgICAgICAgICAgICAgICBpZiAobW9iaWxlbWVkaWEudHlwZSA9PT0gMSkgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnBvc3QoYC9tb2JpbGVtZWRpYS9gLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkltYWdlbSAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBtb2JpbGVtZWRpYS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbW9iaWxlbWVkaWEucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBtb2JpbGVtZWRpYS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgICAgICAgICAgICAgIkltYWdlbSAiICsKICAgICAgICAgICAgICAgICAgICAgICAgKGluZGV4bW9iaWxlICsgMSkgKwogICAgICAgICAgICAgICAgICAgICAgICAiICIgKwogICAgICAgICAgICAgICAgICAgICAgICByZXNwb3N0YS5kYXRhLmxhYmVsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pZGluc3RydWN0aW9uYWxlbGVtZW50OiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coImkiLCBpKTsKICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wb3N0KGAvbW9iaWxlbWVkaWEvYCwgewogICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJWaWRlbyAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBtb2JpbGVtZWRpYS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbW9iaWxlbWVkaWEucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBtb2JpbGVtZWRpYS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG1vYmlsZW1lZGlhLnRpbWUsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHVybGxpbms6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZmtfaWRpbnN0cnVjdGlvbmFsZWxlbWVudDogcmVzcG9zdGEuZGF0YS51cmwsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAobW9iaWxlbWVkaWEudHlwZSA9PT0gMykgewogICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnBvc3QoYC9tb2JpbGVtZWRpYS9gLCB7CiAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkF1ZGlvICIgKyAoaW5kZXhtb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOiAiL21lZGlhdHlwZS8iICsgbW9iaWxlbWVkaWEudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IG1vYmlsZW1lZGlhLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG1vYmlsZW1lZGlhLnBhdGguc3BsaXQoIi8iKVsxXSwKICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGRpZmZpY3VsdHlMZXZlbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBma19pZGluc3RydWN0aW9uYWxlbGVtZW50OiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSA1KSB7CiAgICAgICAgICAgICAgICAgICAgYXdhaXQgQXBpKCkucG9zdChgL21vYmlsZW1lZGlhL2AsIHsKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiTGluayAiICsgKGluZGV4bW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZTogIi9tZWRpYXR5cGUvIiArIG1vYmlsZW1lZGlhLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBtb2JpbGVtZWRpYS5vYmplY3QsCiAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgZmtfaWRpbnN0cnVjdGlvbmFsZWxlbWVudDogcmVzcG9zdGEuZGF0YS51cmwsCiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBhbHRlcmFfQ3JpYV9GYXNlcygpIHsKICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgdmFyIGF1eFBhdGhQaGFzZXMgPSAiIjsKICAgICAgdGhpcy5waGFzZXNDb250cm9sLmZvckVhY2goYXN5bmMgZnVuY3Rpb24gKHBoYXNlKSB7CiAgICAgICAgaWYgKHBoYXNlLm1vYmlsZU1lZGlhcy5sZW5ndGggPiAwKSB7CiAgICAgICAgICBhd2FpdCBwaGFzZS5tb2JpbGVNZWRpYXMuZm9yRWFjaChhc3luYyAobW9iaWxlbWVkaWEpID0+IHsKICAgICAgICAgICAgaWYgKG1vYmlsZW1lZGlhLnVybCkgewogICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS50eXBlICE9PSA1KSB7CiAgICAgICAgICAgICAgICBmaXJlYmFzZQogICAgICAgICAgICAgICAgICAuc3RvcmFnZSgpCiAgICAgICAgICAgICAgICAgIC5yZWYoKQogICAgICAgICAgICAgICAgICAuY2hpbGQobW9iaWxlbWVkaWEucGF0aCkKICAgICAgICAgICAgICAgICAgLnB1dChtb2JpbGVtZWRpYS5vYmplY3QpOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICBhdXhQYXRoUGhhc2VzID0KICAgICAgICAgICAgICAgIHZtLmRvbWFpbi5pZGtub3dsZWRnZWRvbWFpbi50b1N0cmluZygpICsKICAgICAgICAgICAgICAgICIvIiArCiAgICAgICAgICAgICAgICAoYXdhaXQgc2V0VGltZW91dChhc3luYyBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICAgIGF3YWl0IERhdGUubm93KCkudG9TdHJpbmcoKTsKICAgICAgICAgICAgICAgIH0sIDEpKTsKICAgICAgICAgICAgICBpZiAobW9iaWxlbWVkaWEudHlwZSAhPT0gNSkgewogICAgICAgICAgICAgICAgZmlyZWJhc2UKICAgICAgICAgICAgICAgICAgLnN0b3JhZ2UoKQogICAgICAgICAgICAgICAgICAucmVmKCkKICAgICAgICAgICAgICAgICAgLmNoaWxkKGF1eFBhdGhQaGFzZXMpCiAgICAgICAgICAgICAgICAgIC5wdXQobW9iaWxlbWVkaWEub2JqZWN0KTsKCiAgICAgICAgICAgICAgICBtb2JpbGVtZWRpYS5wYXRoID0gYXV4UGF0aFBoYXNlczsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICAgIHRoaXMucGhhc2VzQ29udHJvbC5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uIChwaGFzZSwgaW5kZXgpIHsKICAgICAgICBpZiAocGhhc2UudXJsID09PSBudWxsKSB7CiAgICAgICAgICBhd2FpdCBBcGkoKQogICAgICAgICAgICAucG9zdChgL3BoYXNlcHJvY2VkdXJlL2AsIHsKICAgICAgICAgICAgICBvcmRlcjogaW5kZXggKyAxLAogICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwaGFzZS5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgICBma19pbmZvcm1hdGlvbml0ZW06IHZtLmF1eEl0ZW1JbmZvLAogICAgICAgICAgICB9KQogICAgICAgICAgICAudGhlbihhc3luYyBmdW5jdGlvbiAocmVzcG9zdGEpIHsKICAgICAgICAgICAgICBpZiAocGhhc2UubW9iaWxlTWVkaWFzLmxlbmd0aCA+IDApIHsKICAgICAgICAgICAgICAgIGF3YWl0IHBoYXNlLm1vYmlsZU1lZGlhcy5mb3JFYWNoKGFzeW5jIGZ1bmN0aW9uICgKICAgICAgICAgICAgICAgICAgZWxlbWVudE1vYmlsZSwKICAgICAgICAgICAgICAgICAgaW5kZXhNb2JpbGUKICAgICAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudE1vYmlsZS51cmwpIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQoZWxlbWVudE1vYmlsZS51cmwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJJbWFnZW0gIiArIChpbmRleE1vYmlsZSArIDEpLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZToKICAgICAgICAgICAgICAgICAgICAgICAgICAiL21lZGlhdHlwZS8iICsgZWxlbWVudE1vYmlsZS50eXBlICsgIi8iLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBlbGVtZW50TW9iaWxlLnBhdGgsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlc29sdXRpb246IGVsZW1lbnRNb2JpbGUucmVzb2x1dGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IGVsZW1lbnRNb2JpbGUubmFtZWZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICJJbWFnZW0gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGluZGV4TW9iaWxlICsgMSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICIgRmFzZSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Bvc3RhLmRhdGEub3JkZXJxdWVzdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZHBoYXNlcHJvY2VkdXJlOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQoZWxlbWVudE1vYmlsZS51cmwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJWaWRlbyAiICsgKGluZGV4TW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICIvbWVkaWF0eXBlLyIgKyBlbGVtZW50TW9iaWxlLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogZWxlbWVudE1vYmlsZS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5uYW1lZmlsZSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IGVsZW1lbnRNb2JpbGUudGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZHBoYXNlcHJvY2VkdXJlOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQoZWxlbWVudE1vYmlsZS51cmwsIHsKICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWw6ICJBdWRpbyAiICsgKGluZGV4TW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICIvbWVkaWF0eXBlLyIgKyBlbGVtZW50TW9iaWxlLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IGVsZW1lbnRNb2JpbGUubmFtZWZpbGUsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkcGhhc2Vwcm9jZWR1cmU6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50TW9iaWxlLnR5cGUgPT09IDUpIHsKICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnB1dChlbGVtZW50TW9iaWxlLnVybCwgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkxpbmsgIiArIChpbmRleE1vYmlsZSArIDEpICsgdm0uaSsrICogMCwKICAgICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIi9tZWRpYXR5cGUvIiArIGVsZW1lbnRNb2JpbGUudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgbmFtZWZpbGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBlbGVtZW50TW9iaWxlLm9iamVjdCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZHBoYXNlcHJvY2VkdXJlOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAxKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wb3N0KGAvbW9iaWxlbWVkaWEvYCwgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkltYWdlbSAiICsgKGluZGV4TW9iaWxlICsgMSksCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkbWVkaWF0eXBlOgogICAgICAgICAgICAgICAgICAgICAgICAgICIvbWVkaWF0eXBlLyIgKyBlbGVtZW50TW9iaWxlLnR5cGUgKyAiLyIsCiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGg6IGVsZW1lbnRNb2JpbGUucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcmVzb2x1dGlvbjogZWxlbWVudE1vYmlsZS5yZXNvbHV0aW9uLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgICAgICAgICAgICAgICAgICAgICJJbWFnZW0gIiArCiAgICAgICAgICAgICAgICAgICAgICAgICAgKGluZGV4TW9iaWxlICsgMSkgKwogICAgICAgICAgICAgICAgICAgICAgICAgICIgRmFzZSIgKwogICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3Bvc3RhLmRhdGEub3JkZXJxdWVzdGlvbiwKICAgICAgICAgICAgICAgICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZHBoYXNlcHJvY2VkdXJlOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wb3N0KGAvbW9iaWxlbWVkaWEvYCwgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIlZpZGVvICIgKyAoaW5kZXhNb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIi9tZWRpYXR5cGUvIiArIGVsZW1lbnRNb2JpbGUudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBlbGVtZW50TW9iaWxlLnJlc29sdXRpb24sCiAgICAgICAgICAgICAgICAgICAgICAgIG5hbWVmaWxlOiBlbGVtZW50TW9iaWxlLnBhdGguc3BsaXQoIi8iKVsxXSwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IGVsZW1lbnRNb2JpbGUudGltZSwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dGZ1bGw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRzaG9ydDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdXJsbGluazogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGlmZmljdWx0eUxldmVsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBsZWFybmluZ1N0eWxlOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZHBoYXNlcHJvY2VkdXJlOiByZXNwb3N0YS5kYXRhLnVybCwKICAgICAgICAgICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgICAgICAgIH0gZWxzZSBpZiAoZWxlbWVudE1vYmlsZS50eXBlID09PSAzKSB7CiAgICAgICAgICAgICAgICAgICAgICBhd2FpdCBBcGkoKS5wb3N0KGAvbW9iaWxlbWVkaWEvYCwgewogICAgICAgICAgICAgICAgICAgICAgICBsYWJlbDogIkF1ZGlvICIgKyAoaW5kZXhNb2JpbGUgKyAxKSwKICAgICAgICAgICAgICAgICAgICAgICAgZmtfaWRtZWRpYXR5cGU6CiAgICAgICAgICAgICAgICAgICAgICAgICAgIi9tZWRpYXR5cGUvIiArIGVsZW1lbnRNb2JpbGUudHlwZSArICIvIiwKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aDogZWxlbWVudE1vYmlsZS5wYXRoLAogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogZWxlbWVudE1vYmlsZS5wYXRoLnNwbGl0KCIvIilbMV0sCiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0aW1lOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0ZnVsbDogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgdGV4dHNob3J0OiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB1cmxsaW5rOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkcGhhc2Vwcm9jZWR1cmU6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChlbGVtZW50TW9iaWxlLnR5cGUgPT09IDUpIHsKICAgICAgICAgICAgICAgICAgICAgIGF3YWl0IEFwaSgpLnBvc3QoYC9tb2JpbGVtZWRpYS9gLCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVsOiAiTGluayAiICsgKGluZGV4TW9iaWxlICsgMSkgKyB2bS5pKysgKiAwLAogICAgICAgICAgICAgICAgICAgICAgICBma19pZG1lZGlhdHlwZToKICAgICAgICAgICAgICAgICAgICAgICAgICAiL21lZGlhdHlwZS8iICsgZWxlbWVudE1vYmlsZS50eXBlICsgIi8iLAogICAgICAgICAgICAgICAgICAgICAgICBwYXRoOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICBuYW1lZmlsZTogbnVsbCwKICAgICAgICAgICAgICAgICAgICAgICAgZGVzY3JpcHRpb246IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHRleHRmdWxsOiBudWxsLAogICAgICAgICAgICAgICAgICAgICAgICB0ZXh0c2hvcnQ6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIHVybGxpbms6IGVsZW1lbnRNb2JpbGUub2JqZWN0LAogICAgICAgICAgICAgICAgICAgICAgICBkaWZmaWN1bHR5TGV2ZWw6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGxlYXJuaW5nU3R5bGU6IG51bGwsCiAgICAgICAgICAgICAgICAgICAgICAgIGZrX2lkcGhhc2Vwcm9jZWR1cmU6IHJlc3Bvc3RhLmRhdGEudXJsLAogICAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBhd2FpdCBBcGkoKS5wdXQocGhhc2UudXJsLCB7CiAgICAgICAgICAgIG9yZGVyOiBpbmRleCArIDEsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwaGFzZS5kZXNjcmlwdGlvbiwKICAgICAgICAgICAgZmtfaW5mb3JtYXRpb25pdGVtOiB2bS5hdXhJdGVtSW5mbywKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgfSk7CiAgICB9LAoKICAgIGFzeW5jIHZhbGlkYXRlKCkgewogICAgICBpZiAodGhpcy4kcmVmcy5mb3JtLnZhbGlkYXRlKCkpIHsKICAgICAgICBpZiAodGhpcy5waGFzZXNDb250cm9sLmxlbmd0aCA+IDApIHsKICAgICAgICAgIHZhciBpID0gdGhpcy5waGFzZXNDb250cm9sLmxlbmd0aDsKICAgICAgICAgIGF3YWl0IHRoaXMuYWx0ZXJhX0NyaWFfUHJvY2VkaW1lbnRvKCk7CiAgICAgICAgICBhd2FpdCB0aGlzLmFsdGVyYV9DcmlhX0Zhc2VzKCk7CiAgICAgICAgICB0aGlzLnBoYXNlc0NvbnRyb2wgPSBbXTsKICAgICAgICAgIGF3YWl0IHRoaXMuJGVtaXQoInByb2NlZHVyZWNsb3NlIiwgInNhdmUiLCBpKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgdGhpcy5kaWFsb2dfYWxlcnQgPSB0cnVlOwogICAgICAgIH0KICAgICAgfQogICAgfSwKICAgIHJlc2V0KCkgewogICAgICB0aGlzLiRyZWZzLmZvcm0ucmVzZXQoKTsKICAgICAgdGhpcy5waGFzZXNDb250cm9sID0gW107CiAgICAgIHRoaXMuJGVtaXQoInByb2NlZHVyZWNsb3NlIiwgImNsb3NlIik7CiAgICB9LAogICAgYWRkUGhhc2UoKSB7CiAgICAgIHRoaXMucGhhc2VzQ29udHJvbC5wdXNoKHsKICAgICAgICBkZXNjcmlwdGlvbjogbnVsbCwKICAgICAgICBtb2JpbGVNZWRpYXM6IFtdLAogICAgICAgIHVybDogbnVsbCwKICAgICAgfSk7CiAgICB9LAogICAgYXN5bmMgZGVsZXRhUGhhc2UoaWRQaGFzZSkgewogICAgICBpZiAodGhpcy5waGFzZXNDb250cm9sW2lkUGhhc2VdLnVybCAhPT0gbnVsbCkgewogICAgICAgIGF3YWl0IEFwaSgpLmRlbGV0ZSh0aGlzLnBoYXNlc0NvbnRyb2xbaWRQaGFzZV0udXJsKTsKICAgICAgICBhd2FpdCB0aGlzLmFsdGVyYV9DcmlhX0Zhc2VzKCk7CiAgICAgIH0KICAgICAgaWYgKGlkUGhhc2UgPT0gMCkgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbC5zaGlmdCgpOwogICAgICB9IGVsc2UgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbC5zcGxpY2UoaWRQaGFzZSwgMSk7CiAgICAgIH0KICAgIH0sCiAgICBhZGRNb2JpbGVNZWRpYShtb2JpbGVNZWRpYVR5cGUpIHsKICAgICAgaWYgKG1vYmlsZU1lZGlhVHlwZSA9PT0gMSkgewogICAgICAgIHRoaXMubW9iaWxlTWVkaWFzQ29udHJvbC5wdXNoKHsKICAgICAgICAgIHR5cGU6IG1vYmlsZU1lZGlhVHlwZSwKICAgICAgICAgIG9iamVjdDogbnVsbCwKICAgICAgICAgIHJlc29sdXRpb246IG51bGwsCiAgICAgICAgICBwYXRoOiBudWxsLAogICAgICAgICAgbmFtZWZpbGU6IG51bGwsCiAgICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAobW9iaWxlTWVkaWFUeXBlID09PSAyKSB7CiAgICAgICAgdGhpcy5tb2JpbGVNZWRpYXNDb250cm9sLnB1c2goewogICAgICAgICAgdHlwZTogbW9iaWxlTWVkaWFUeXBlLAogICAgICAgICAgb2JqZWN0OiBudWxsLAogICAgICAgICAgcmVzb2x1dGlvbjogbnVsbCwKICAgICAgICAgIHRpbWU6IG51bGwsCiAgICAgICAgICBwYXRoOiBudWxsLAogICAgICAgICAgbmFtZWZpbGU6IG51bGwsCiAgICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgfSk7CiAgICAgIH0gZWxzZSBpZiAobW9iaWxlTWVkaWFUeXBlID09PSAzKSB7CiAgICAgICAgdGhpcy5tb2JpbGVNZWRpYXNDb250cm9sLnB1c2goewogICAgICAgICAgdHlwZTogbW9iaWxlTWVkaWFUeXBlLAogICAgICAgICAgb2JqZWN0OiBudWxsLAogICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgIG5hbWVmaWxlOiBudWxsLAogICAgICAgICAgdXJsOiBudWxsLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKG1vYmlsZU1lZGlhVHlwZSA9PT0gNCkgewogICAgICAgIHRoaXMubW9iaWxlTWVkaWFzQ29udHJvbC5wdXNoKHsKICAgICAgICAgIHR5cGU6IG1vYmlsZU1lZGlhVHlwZSArIDEsCiAgICAgICAgICBvYmplY3Q6IG51bGwsCiAgICAgICAgICB1cmw6IG51bGwsCiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBkZWxldGVNb2JpbGVNZWRpYShpZE1vYmlsZU1lZGlhKSB7CiAgICAgIGlmICh0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2xbaWRNb2JpbGVNZWRpYV0udXJsKSB7CiAgICAgICAgaWYgKHRoaXMubW9iaWxlTWVkaWFzQ29udHJvbFtpZE1vYmlsZU1lZGlhXS50eXBlICE9PSA1KSB7CiAgICAgICAgICBhd2FpdCBmaXJlYmFzZQogICAgICAgICAgICAuc3RvcmFnZSgpCiAgICAgICAgICAgIC5yZWYoKQogICAgICAgICAgICAuY2hpbGQodGhpcy5tb2JpbGVNZWRpYXNDb250cm9sW2lkTW9iaWxlTWVkaWFdLnBhdGgpCiAgICAgICAgICAgIC5kZWxldGUoKTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgQXBpKCkuZGVsZXRlKHRoaXMubW9iaWxlTWVkaWFzQ29udHJvbFtpZE1vYmlsZU1lZGlhXS51cmwpOwogICAgICB9CiAgICAgIGlmIChpZE1vYmlsZU1lZGlhID09IDApIHsKICAgICAgICB0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2wuc2hpZnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2wuc3BsaWNlKGlkTW9iaWxlTWVkaWEsIDEpOwogICAgICB9CiAgICB9LAogICAgYXR1YWxpemFNZXRhKCkgewogICAgICBpZiAodGhpcy5tb2JpbGVNZWRpYXNDb250cm9sLmxlbmd0aCA+IDApIHsKICAgICAgICB0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2wuZm9yRWFjaCgobW9iaWxlbWVkaWEpID0+IHsKICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS5vYmplY3QgJiYgIW1vYmlsZW1lZGlhLnVybCkgewogICAgICAgICAgICBpZiAobW9iaWxlbWVkaWEudHlwZSA9PT0gMSkgewogICAgICAgICAgICAgIHZhciBpbWcgPSBuZXcgSW1hZ2UoKTsKICAgICAgICAgICAgICBpbWcuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChtb2JpbGVtZWRpYS5vYmplY3QpOwogICAgICAgICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgICBtb2JpbGVtZWRpYS5yZXNvbHV0aW9uID0gaW1nLndpZHRoICsgIlgiICsgaW1nLmhlaWdodDsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9IGVsc2UgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDIpIHsKICAgICAgICAgICAgICB2YXIgdmlkZW8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJ2aWRlbyIpOwogICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzb3VyY2UiKTsKICAgICAgICAgICAgICBzb3VyY2Uuc2V0QXR0cmlidXRlKAogICAgICAgICAgICAgICAgInNyYyIsCiAgICAgICAgICAgICAgICBVUkwuY3JlYXRlT2JqZWN0VVJMKG1vYmlsZW1lZGlhLm9iamVjdCkKICAgICAgICAgICAgICApOwogICAgICAgICAgICAgIHZpZGVvLmFwcGVuZENoaWxkKHNvdXJjZSk7CiAgICAgICAgICAgICAgdmlkZW8ub25jYW5wbGF5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgbW9iaWxlbWVkaWEucmVzb2x1dGlvbiA9CiAgICAgICAgICAgICAgICAgIHZpZGVvLnZpZGVvV2lkdGggKyAiWCIgKyB2aWRlby52aWRlb0hlaWdodDsKICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLnRpbWUgPSB2aWRlby5kdXJhdGlvbjsKICAgICAgICAgICAgICB9OwogICAgICAgICAgICB9CiAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBnZXRTcmNJbWFnZShpbmRleE1vYmlsZSwgcGF0aCwgbmFtZWZpbGUpIHsKICAgICAgLyp2YXIgb2JqID0ge307Ki8KICAgICAgaWYgKHBhdGgpIHsKICAgICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAgIGF3YWl0IGZpcmViYXNlCiAgICAgICAgICAuc3RvcmFnZSgpCiAgICAgICAgICAucmVmKHBhdGgpCiAgICAgICAgICAuZ2V0RG93bmxvYWRVUkwoKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVybCkgewogICAgICAgICAgICAvKnZtLnZpZXdJbWFnZVNyYyA9IHVybDsqLwogICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAiYmxvYiI7CiAgICAgICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIGJsb2IgPSB4aHIucmVzcG9uc2U7CiAgICAgICAgICAgICAgdmFyIGZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIG5hbWVmaWxlLCB7CiAgICAgICAgICAgICAgICB0eXBlOiBibG9iLnR5cGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gdm0uYXV4R2V0U3JjLnB1c2goZmlsZSk7CiAgICAgICAgICAgICAgdm0uYXR1YWxpemFPYmooZmlsZSwgaW5kZXhNb2JpbGUpOwogICAgICAgICAgICB9OwogICAgICAgICAgICB4aHIub3BlbigiR0VUIiwgdXJsKTsKICAgICAgICAgICAgeGhyLnNlbmQoKTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgZ2V0U3JjVmlkZW8oaW5kZXhNb2JpbGUsIHBhdGgsIG5hbWVmaWxlKSB7CiAgICAgIC8qdmFyIG9iaiA9IHt9OyovCiAgICAgIGlmIChwYXRoKSB7CiAgICAgICAgdmFyIHZtID0gdGhpczsKICAgICAgICBhd2FpdCBmaXJlYmFzZQogICAgICAgICAgLnN0b3JhZ2UoKQogICAgICAgICAgLnJlZihwYXRoKQogICAgICAgICAgLmdldERvd25sb2FkVVJMKCkKICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICh1cmwpIHsKICAgICAgICAgICAgLyp2bS52aWV3VmlkZW9TcmMgPSB1cmw7Ki8KICAgICAgICAgICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOwogICAgICAgICAgICB4aHIucmVzcG9uc2VUeXBlID0gImJsb2IiOwogICAgICAgICAgICB4aHIub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgIHZhciBibG9iID0geGhyLnJlc3BvbnNlOwogICAgICAgICAgICAgIHZhciBmaWxlID0gbmV3IEZpbGUoW2Jsb2JdLCBuYW1lZmlsZSwgewogICAgICAgICAgICAgICAgdHlwZTogYmxvYi50eXBlLAogICAgICAgICAgICAgIH0pOwogICAgICAgICAgICAgIC8vIHZtLmF1eEdldFNyYy5wdXNoKGZpbGUpOwogICAgICAgICAgICAgIHZtLmF0dWFsaXphT2JqKGZpbGUsIGluZGV4TW9iaWxlKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgeGhyLm9wZW4oIkdFVCIsIHVybCk7CiAgICAgICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGdldFNyY0F1ZGlvKGluZGV4TW9iaWxlLCBwYXRoLCBuYW1lZmlsZSkgewogICAgICAvKnZhciBvYmogPSB7fTsqLwogICAgICBpZiAocGF0aCkgewogICAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICAgYXdhaXQgZmlyZWJhc2UKICAgICAgICAgIC5zdG9yYWdlKCkKICAgICAgICAgIC5yZWYocGF0aCkKICAgICAgICAgIC5nZXREb3dubG9hZFVSTCgpCiAgICAgICAgICAudGhlbihmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgICAgIC8qdm0udmlld0F1ZGlvU3JjID0gdXJsOyovCiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJibG9iIjsKICAgICAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgYmxvYiA9IHhoci5yZXNwb25zZTsKICAgICAgICAgICAgICB2YXIgZmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgbmFtZWZpbGUsIHsKICAgICAgICAgICAgICAgIHR5cGU6IGJsb2IudHlwZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyB2bS5hdXhHZXRTcmMucHVzaChmaWxlKTsKICAgICAgICAgICAgICB2bS5hdHVhbGl6YU9iaihmaWxlLCBpbmRleE1vYmlsZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5vcGVuKCJHRVQiLCB1cmwpOwogICAgICAgICAgICB4aHIuc2VuZCgpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhdHVhbGl6YU9iaihmaWxlLCBpbmRleE1vYmlsZSkgewogICAgICB0aGlzLm1vYmlsZU1lZGlhc0NvbnRyb2xbaW5kZXhNb2JpbGVdLm9iamVjdCA9IGZpbGU7CiAgICB9LAogICAgYWRkTW9iaWxlTWVkaWFQaGFzZShpZFBoYXNlLCBtb2JpbGVNZWRpYVR5cGUpIHsKICAgICAgaWYgKG1vYmlsZU1lZGlhVHlwZSA9PT0gMSkgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXMucHVzaCh7CiAgICAgICAgICB0eXBlOiBtb2JpbGVNZWRpYVR5cGUsCiAgICAgICAgICBvYmplY3Q6IG51bGwsCiAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgIG5hbWVmaWxlOiBudWxsLAogICAgICAgICAgdXJsOiBudWxsLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKG1vYmlsZU1lZGlhVHlwZSA9PT0gMikgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXMucHVzaCh7CiAgICAgICAgICB0eXBlOiBtb2JpbGVNZWRpYVR5cGUsCiAgICAgICAgICBvYmplY3Q6IG51bGwsCiAgICAgICAgICByZXNvbHV0aW9uOiBudWxsLAogICAgICAgICAgdGltZTogbnVsbCwKICAgICAgICAgIHBhdGg6IG51bGwsCiAgICAgICAgICBuYW1lZmlsZTogbnVsbCwKICAgICAgICAgIHVybDogbnVsbCwKICAgICAgICB9KTsKICAgICAgfSBlbHNlIGlmIChtb2JpbGVNZWRpYVR5cGUgPT09IDMpIHsKICAgICAgICB0aGlzLnBoYXNlc0NvbnRyb2xbaWRQaGFzZV0ubW9iaWxlTWVkaWFzLnB1c2goewogICAgICAgICAgdHlwZTogbW9iaWxlTWVkaWFUeXBlLAogICAgICAgICAgb2JqZWN0OiBudWxsLAogICAgICAgICAgcGF0aDogbnVsbCwKICAgICAgICAgIG5hbWVmaWxlOiBudWxsLAogICAgICAgICAgdXJsOiBudWxsLAogICAgICAgIH0pOwogICAgICB9IGVsc2UgaWYgKG1vYmlsZU1lZGlhVHlwZSA9PT0gNCkgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXMucHVzaCh7CiAgICAgICAgICB0eXBlOiBtb2JpbGVNZWRpYVR5cGUgKyAxLAogICAgICAgICAgb2JqZWN0OiBudWxsLAogICAgICAgICAgdXJsOiBudWxsLAogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXN5bmMgZGVsZXRlTW9iaWxlTWVkaWFQaGFzZShpZFBoYXNlLCBpZE1vYmlsZU1lZGlhKSB7CiAgICAgIGlmICh0aGlzLnBoYXNlc0NvbnRyb2xbaWRQaGFzZV0ubW9iaWxlTWVkaWFzW2lkTW9iaWxlTWVkaWFdLnVybCkgewogICAgICAgIGlmICgKICAgICAgICAgIHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXNbaWRNb2JpbGVNZWRpYV0udHlwZSAhPT0gNQogICAgICAgICkgewogICAgICAgICAgYXdhaXQgZmlyZWJhc2UKICAgICAgICAgICAgLnN0b3JhZ2UoKQogICAgICAgICAgICAucmVmKCkKICAgICAgICAgICAgLmNoaWxkKHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXNbaWRNb2JpbGVNZWRpYV0ucGF0aCkKICAgICAgICAgICAgLmRlbGV0ZSgpOwogICAgICAgIH0KICAgICAgICBhd2FpdCBBcGkoKS5kZWxldGUoCiAgICAgICAgICB0aGlzLnBoYXNlc0NvbnRyb2xbaWRQaGFzZV0ubW9iaWxlTWVkaWFzW2lkTW9iaWxlTWVkaWFdLnVybAogICAgICAgICk7CiAgICAgIH0KICAgICAgaWYgKGlkTW9iaWxlTWVkaWEgPT0gMCkgewogICAgICAgIHRoaXMucGhhc2VzQ29udHJvbFtpZFBoYXNlXS5tb2JpbGVNZWRpYXMuc2hpZnQoKTsKICAgICAgfSBlbHNlIHsKICAgICAgICB0aGlzLnBoYXNlc0NvbnRyb2xbaWRQaGFzZV0ubW9iaWxlTWVkaWFzLnNwbGljZShpZE1vYmlsZU1lZGlhLCAxKTsKICAgICAgfQogICAgfSwKICAgIGF0dWFsaXphTWV0YVBoYXNlcygpIHsKICAgICAgaWYgKHRoaXMucGhhc2VzQ29udHJvbC5sZW5ndGggPiAwKSB7CiAgICAgICAgdGhpcy5waGFzZXNDb250cm9sLmZvckVhY2goKHBoYXNlKSA9PiB7CiAgICAgICAgICBpZiAocGhhc2UubW9iaWxlTWVkaWFzKSB7CiAgICAgICAgICAgIHBoYXNlLm1vYmlsZU1lZGlhcy5mb3JFYWNoKChtb2JpbGVtZWRpYSkgPT4gewogICAgICAgICAgICAgIGlmIChtb2JpbGVtZWRpYS5vYmplY3QgJiYgIW1vYmlsZW1lZGlhLnVybCkgewogICAgICAgICAgICAgICAgaWYgKG1vYmlsZW1lZGlhLnR5cGUgPT09IDEpIHsKICAgICAgICAgICAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICAgICAgICBpbWcuc3JjID0gVVJMLmNyZWF0ZU9iamVjdFVSTChtb2JpbGVtZWRpYS5vYmplY3QpOwogICAgICAgICAgICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLnJlc29sdXRpb24gPSBpbWcud2lkdGggKyAiWCIgKyBpbWcuaGVpZ2h0OwogICAgICAgICAgICAgICAgICB9OwogICAgICAgICAgICAgICAgfSBlbHNlIGlmIChtb2JpbGVtZWRpYS50eXBlID09PSAyKSB7CiAgICAgICAgICAgICAgICAgIHZhciB2aWRlbyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoInZpZGVvIik7CiAgICAgICAgICAgICAgICAgIHZhciBzb3VyY2UgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJzb3VyY2UiKTsKICAgICAgICAgICAgICAgICAgc291cmNlLnNldEF0dHJpYnV0ZSgKICAgICAgICAgICAgICAgICAgICAic3JjIiwKICAgICAgICAgICAgICAgICAgICBVUkwuY3JlYXRlT2JqZWN0VVJMKG1vYmlsZW1lZGlhLm9iamVjdCkKICAgICAgICAgICAgICAgICAgKTsKICAgICAgICAgICAgICAgICAgdmlkZW8uYXBwZW5kQ2hpbGQoc291cmNlKTsKICAgICAgICAgICAgICAgICAgdmlkZW8ub25jYW5wbGF5ID0gZnVuY3Rpb24gKCkgewogICAgICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLnJlc29sdXRpb24gPQogICAgICAgICAgICAgICAgICAgICAgdmlkZW8udmlkZW9XaWR0aCArICJYIiArIHZpZGVvLnZpZGVvSGVpZ2h0OwogICAgICAgICAgICAgICAgICAgIG1vYmlsZW1lZGlhLnRpbWUgPSB2aWRlby5kdXJhdGlvbjsKICAgICAgICAgICAgICAgICAgfTsKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgIH0pOwogICAgICB9CiAgICB9LAogICAgYXR1YWxpemFPYmpQaGFzZXMoZmlsZSwgaW5kZXhQaGFzZSwgaW5kZXhNb2JpbGUpIHsKICAgICAgdGhpcy5waGFzZXNDb250cm9sW2luZGV4UGhhc2VdLm1vYmlsZU1lZGlhc1tpbmRleE1vYmlsZV0ub2JqZWN0ID0gZmlsZTsKICAgIH0sCiAgICBhc3luYyBnZXRTcmNJbWFnZVBoYXNlcyhpbmRleFBoYXNlLCBpbmRleE1vYmlsZSwgcGF0aCwgbmFtZWZpbGUpIHsKICAgICAgLyp2YXIgb2JqID0ge307Ki8KICAgICAgaWYgKHBhdGgpIHsKICAgICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAgIGF3YWl0IGZpcmViYXNlCiAgICAgICAgICAuc3RvcmFnZSgpCiAgICAgICAgICAucmVmKHBhdGgpCiAgICAgICAgICAuZ2V0RG93bmxvYWRVUkwoKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVybCkgewogICAgICAgICAgICAvKnZtLnZpZXdJbWFnZVNyYyA9IHVybDsqLwogICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAiYmxvYiI7CiAgICAgICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIGJsb2IgPSB4aHIucmVzcG9uc2U7CiAgICAgICAgICAgICAgdmFyIGZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIG5hbWVmaWxlLCB7CiAgICAgICAgICAgICAgICB0eXBlOiBibG9iLnR5cGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLyp2bS5hdXhHZXRTcmNQaGFzZXMucHVzaChmaWxlKTsqLwogICAgICAgICAgICAgIHZtLmF0dWFsaXphT2JqUGhhc2VzKGZpbGUsIGluZGV4UGhhc2UsIGluZGV4TW9iaWxlKTsKICAgICAgICAgICAgfTsKICAgICAgICAgICAgeGhyLm9wZW4oIkdFVCIsIHVybCk7CiAgICAgICAgICAgIHhoci5zZW5kKCk7CiAgICAgICAgICB9KTsKICAgICAgfQogICAgfSwKICAgIGFzeW5jIGdldFNyY1ZpZGVvUGhhc2VzKGluZGV4UGhhc2UsIGluZGV4TW9iaWxlLCBwYXRoLCBuYW1lZmlsZSkgewogICAgICAvKnZhciBvYmogPSB7fTsqLwogICAgICBpZiAocGF0aCkgewogICAgICAgIHZhciB2bSA9IHRoaXM7CiAgICAgICAgYXdhaXQgZmlyZWJhc2UKICAgICAgICAgIC5zdG9yYWdlKCkKICAgICAgICAgIC5yZWYocGF0aCkKICAgICAgICAgIC5nZXREb3dubG9hZFVSTCgpCiAgICAgICAgICAudGhlbihmdW5jdGlvbiAodXJsKSB7CiAgICAgICAgICAgIC8qdm0udmlld1ZpZGVvU3JjID0gdXJsOyovCiAgICAgICAgICAgIHZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsKICAgICAgICAgICAgeGhyLnJlc3BvbnNlVHlwZSA9ICJibG9iIjsKICAgICAgICAgICAgeGhyLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHsKICAgICAgICAgICAgICB2YXIgYmxvYiA9IHhoci5yZXNwb25zZTsKICAgICAgICAgICAgICB2YXIgZmlsZSA9IG5ldyBGaWxlKFtibG9iXSwgbmFtZWZpbGUsIHsKICAgICAgICAgICAgICAgIHR5cGU6IGJsb2IudHlwZSwKICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAvLyB2bS5hdXhHZXRTcmNQaGFzZXMucHVzaChmaWxlKTsKICAgICAgICAgICAgICB2bS5hdHVhbGl6YU9ialBoYXNlcyhmaWxlLCBpbmRleFBoYXNlLCBpbmRleE1vYmlsZSk7CiAgICAgICAgICAgIH07CiAgICAgICAgICAgIHhoci5vcGVuKCJHRVQiLCB1cmwpOwogICAgICAgICAgICB4aHIuc2VuZCgpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBhc3luYyBnZXRTcmNBdWRpb1BoYXNlcyhpbmRleFBoYXNlLCBpbmRleE1vYmlsZSwgcGF0aCwgbmFtZWZpbGUpIHsKICAgICAgLyp2YXIgb2JqID0ge307Ki8KICAgICAgaWYgKHBhdGgpIHsKICAgICAgICB2YXIgdm0gPSB0aGlzOwogICAgICAgIGF3YWl0IGZpcmViYXNlCiAgICAgICAgICAuc3RvcmFnZSgpCiAgICAgICAgICAucmVmKHBhdGgpCiAgICAgICAgICAuZ2V0RG93bmxvYWRVUkwoKQogICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKHVybCkgewogICAgICAgICAgICAvKnZtLnZpZXdBdWRpb1NyYyA9IHVybDsqLwogICAgICAgICAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CiAgICAgICAgICAgIHhoci5yZXNwb25zZVR5cGUgPSAiYmxvYiI7CiAgICAgICAgICAgIHhoci5vbmxvYWQgPSBmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgICAgdmFyIGJsb2IgPSB4aHIucmVzcG9uc2U7CiAgICAgICAgICAgICAgdmFyIGZpbGUgPSBuZXcgRmlsZShbYmxvYl0sIG5hbWVmaWxlLCB7CiAgICAgICAgICAgICAgICB0eXBlOiBibG9iLnR5cGUsCiAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgLy8gdm0uYXV4R2V0U3JjUGhhc2VzLnB1c2goZmlsZSk7CiAgICAgICAgICAgICAgdm0uYXR1YWxpemFPYmpQaGFzZXMoZmlsZSwgaW5kZXhQaGFzZSwgaW5kZXhNb2JpbGUpOwogICAgICAgICAgICB9OwogICAgICAgICAgICB4aHIub3BlbigiR0VUIiwgdXJsKTsKICAgICAgICAgICAgeGhyLnNlbmQoKTsKICAgICAgICAgIH0pOwogICAgICB9CiAgICB9LAogIH0sCn07Cg=="},{"version":3,"sources":["ProcedureDialog.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkUA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ProcedureDialog.vue","sourceRoot":"src/components/instructional_model","sourcesContent":["<template>\n  <v-container class=\"pa-0\">\n    <v-card>\n      <v-card-title style=\"background-color:#63B0B0; color:white;\">\n        <span class=\"headline\">\n          <p>Descreva o procedimento a ser criado.</p>\n        </span>\n        <v-spacer></v-spacer>\n        <v-menu width=\"300px\" origin=\"bottom bottom\" :offset-y=\"true\" transition=\"scale-transition\">\n          <template v-slot:activator=\"{ on }\">\n            <v-btn v-on=\"on\" large color=\"primary\" style=\"color:white;\" class=\"mb-3\">\n              <strong>Adicionar MobileMedia</strong>\n              <v-icon class=\"ml-2\" large color=\"white\">mdi-apps</v-icon>\n            </v-btn>\n          </template>\n\n          <v-list>\n            <v-list-item\n              v-for=\"(item, i) in itemsMobileMedia\"\n              :key=\"i\"\n              @click=\"addMobileMedia(i + 1)\"\n            >\n              <v-icon x-large color=\"blue\">{{ item.icon }}</v-icon>\n              <v-list-item-title style=\"font-size: 1.2em; color:#2196F3;\" class=\"ml-1\">\n                <strong>{{ item.name }}</strong>\n              </v-list-item-title>\n            </v-list-item>\n          </v-list>\n        </v-menu>\n      </v-card-title>\n      <v-card-text>\n        <v-form ref=\"form\" v-model=\"valid\" lazy-validation class=\"mt-3\">\n          <label class=\"pt-2\" style=\"font-size:1.3em;\" for=\"procedureNameArea\">\n            <strong>Identificador do procedimento:</strong>\n          </label>\n          <v-text-field\n            id=\"procedureNameArea\"\n            v-model=\"procedureName\"\n            :counter=\"100\"\n            :rules=\"procedureNameRules\"\n            required\n            class=\"mt-2 mb-4\"\n          ></v-text-field>\n          <label class=\"pt-2\" style=\"font-size:1.3em;\" for=\"procedureDescriptionArea\">\n            <strong>Escreva a descrio do procedimento:</strong>\n          </label>\n          <v-textarea\n            id=\"procedureDescriptionArea\"\n            v-model=\"procedureDescription\"\n            :rules=\"procedureDescriptionRules\"\n            background-color=\"#F2F3F3\"\n            clearable\n            clear-icon=\"mdi-close-circle\"\n            class=\"mt-2\"\n            name=\"input-3-1\"\n            filled\n            auto-grow\n            required\n          ></v-textarea>\n          <div v-if=\"mobileMediasControl.length > 0\">\n            <label class=\"mb-6 pt-2\" style=\"font-size:1.3em;\">\n              <strong>MobileMedias do procedimento:</strong>\n            </label>\n            <div class=\"mt-8\"></div>\n            <div v-for=\"(mobilemedia, i) in mobileMediasControl\" :key=\"i\">\n              <v-row v-if=\"mobilemedia.type === 1\">\n                <v-spacer></v-spacer>\n                <v-file-input\n                  style=\"width: 165px;\"\n                  label=\"UPLOAD IMAGE\"\n                  filled\n                  @change=\"atualizaMeta\"\n                  v-model=\"mobilemedia.object\"\n                  accept=\"image/*\"\n                  prepend-icon=\"mdi-camera\"\n                ></v-file-input>\n                <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                  <v-icon x-large color=\"red\" @click=\"deleteMobileMedia(i)\">mdi-minus-box</v-icon>\n                </v-btn>\n                <v-spacer></v-spacer>\n              </v-row>\n              <v-row v-if=\"mobilemedia.type === 2\">\n                <v-spacer></v-spacer>\n                <v-file-input\n                  style=\"width: 165px;\"\n                  label=\"UPLOAD VIDEO\"\n                  filled\n                  @change=\"atualizaMeta\"\n                  v-model=\"mobilemedia.object\"\n                  accept=\"video/*\"\n                  prepend-icon=\"mdi-video\"\n                ></v-file-input>\n                <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                  <v-icon x-large color=\"red\" @click=\"deleteMobileMedia(i)\">mdi-minus-box</v-icon>\n                </v-btn>\n                <v-spacer></v-spacer>\n              </v-row>\n              <v-row v-if=\"mobilemedia.type === 3\">\n                <v-spacer></v-spacer>\n                <v-file-input\n                  style=\"width: 165px;\"\n                  label=\"UPLOAD AUDIO\"\n                  filled\n                  v-model=\"mobilemedia.object\"\n                  accept=\"audio/*\"\n                  prepend-icon=\"mdi-file-music\"\n                ></v-file-input>\n                <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                  <v-icon x-large color=\"red\" @click=\"deleteMobileMedia(i)\">mdi-minus-box</v-icon>\n                </v-btn>\n                <v-spacer></v-spacer>\n              </v-row>\n              <v-row v-if=\"mobilemedia.type === 5\" class=\"mb-2\">\n                <v-spacer></v-spacer>\n                <v-text-field\n                  v-model=\"mobilemedia.object\"\n                  :rules=\"linkUrlRules\"\n                  label=\"Url\"\n                  required\n                ></v-text-field>\n                <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                  <v-icon x-large color=\"red\" @click=\"deleteMobileMedia(i)\">mdi-minus-box</v-icon>\n                </v-btn>\n                <v-spacer></v-spacer>\n              </v-row>\n            </div>\n          </div>\n          <v-app-bar color=\"#D2A64D\" dense dark height=\"45px\">\n            <v-toolbar-title style=\"font-size:1.2em;\">\n              <strong>Lista de fases do procedimento</strong>\n            </v-toolbar-title>\n          </v-app-bar>\n          <v-container>\n            <v-row style=\"height:50px;\">\n              <v-col cols=\"2\">\n                <strong>\n                  <p style=\"font-size:1.2em;\">Ordem da fase</p>\n                </strong>\n              </v-col>\n              <v-col cols=\"8\">\n                <strong>\n                  <p style=\"font-size:1.2em;\">Descrio da fase</p>\n                </strong>\n              </v-col>\n              <v-col cols=\"1\">\n                <v-btn icon=\"icon\">\n                  <v-icon large class=\"ml-2 mb-3\" color=\"primary\" @click=\"addPhase()\">mdi-plus-box</v-icon>\n                </v-btn>\n              </v-col>\n            </v-row>\n\n            <v-row v-for=\"(item, i) in phasesControl\" :key=\"i\">\n              <v-col\n                cols=\"2\"\n                style=\"text-align:center; font-size: 1.8em; margin-top:10px;\"\n              >{{ i + 1 }}</v-col>\n              <v-col cols=\"8\">\n                <v-textarea\n                  style=\"margin-top: -10px;\"\n                  v-model=\"phasesControl[i].description\"\n                  background-color=\"#F2F3F3\"\n                  :rules=\"phasesControlRules\"\n                  rows=\"2\"\n                  clearable\n                  clear-icon=\"mdi-close-circle\"\n                  filled\n                  auto-grow\n                  required\n                ></v-textarea>\n                <div v-if=\"phasesControl[i].mobileMedias.length > 0\" style=\"width:100%\">\n                  <div\n                    v-for=\"(mobilemedia, idmobile) in phasesControl[i]\n                      .mobileMedias\"\n                    :key=\"idmobile\"\n                  >\n                    <v-row v-if=\"mobilemedia.type === 1\">\n                      <v-spacer></v-spacer>\n                      <v-file-input\n                        style=\"width: 165px;\"\n                        label=\"UPLOAD IMAGE\"\n                        filled\n                        @change=\"atualizaMetaPhases\"\n                        v-model=\"mobilemedia.object\"\n                        accept=\"image/*\"\n                        prepend-icon=\"mdi-camera\"\n                      ></v-file-input>\n                      <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                        <v-icon\n                          x-large\n                          color=\"red\"\n                          @click=\"deleteMobileMediaPhase(i, idmobile)\"\n                        >mdi-minus-box</v-icon>\n                      </v-btn>\n                      <v-spacer></v-spacer>\n                    </v-row>\n                    <v-row v-if=\"mobilemedia.type === 2\">\n                      <v-spacer></v-spacer>\n                      <v-file-input\n                        style=\"width: 165px;\"\n                        label=\"UPLOAD VIDEO\"\n                        filled\n                        @change=\"atualizaMetaPhases\"\n                        v-model=\"mobilemedia.object\"\n                        accept=\"video/*\"\n                        prepend-icon=\"mdi-video\"\n                      ></v-file-input>\n                      <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                        <v-icon\n                          x-large\n                          color=\"red\"\n                          @click=\"deleteMobileMediaPhase(i, idmobile)\"\n                        >mdi-minus-box</v-icon>\n                      </v-btn>\n                      <v-spacer></v-spacer>\n                    </v-row>\n                    <v-row v-if=\"mobilemedia.type === 3\">\n                      <v-spacer></v-spacer>\n                      <v-file-input\n                        style=\"width: 165px;\"\n                        label=\"UPLOAD AUDIO\"\n                        filled\n                        v-model=\"mobilemedia.object\"\n                        accept=\"audio/*\"\n                        prepend-icon=\"mdi-file-music\"\n                      ></v-file-input>\n                      <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                        <v-icon\n                          x-large\n                          color=\"red\"\n                          @click=\"deleteMobileMediaPhase(i, idmobile)\"\n                        >mdi-minus-box</v-icon>\n                      </v-btn>\n                      <v-spacer></v-spacer>\n                    </v-row>\n                    <v-row v-if=\"mobilemedia.type === 5\" class=\"mb-2\">\n                      <v-spacer></v-spacer>\n                      <v-text-field\n                        v-model=\"mobilemedia.object\"\n                        :rules=\"linkUrlRules\"\n                        label=\"Url\"\n                        required\n                      ></v-text-field>\n                      <v-btn icon=\"icon\" class=\"mt-2 ml-3\">\n                        <v-icon\n                          x-large\n                          color=\"red\"\n                          @click=\"deleteMobileMediaPhase(i, idmobile)\"\n                        >mdi-minus-box</v-icon>\n                      </v-btn>\n                      <v-spacer></v-spacer>\n                    </v-row>\n                  </div>\n                </div>\n              </v-col>\n              <v-col cols=\"2\">\n                <v-menu\n                  top=\"top\"\n                  width=\"300px\"\n                  origin=\"center center\"\n                  :offset-y=\"true\"\n                  transition=\"scale-transition\"\n                >\n                  <template v-slot:activator=\"{ on }\">\n                    <v-btn v-on=\"on\" icon=\"icon\">\n                      <v-icon x-large class=\"ml-2\" large color=\"primary\">mdi-apps</v-icon>\n                    </v-btn>\n                  </template>\n\n                  <v-list>\n                    <v-list-item\n                      v-for=\"(item, iditem) in itemsMobileMedia\"\n                      :key=\"iditem\"\n                      @click=\"addMobileMediaPhase(i, iditem + 1)\"\n                    >\n                      <v-icon x-large color=\"blue\">{{ item.icon }}</v-icon>\n                      <v-list-item-title style=\"font-size: 1.2em; color:#2196F3;\" class=\"ml-1\">\n                        <strong>{{ item.name }}</strong>\n                      </v-list-item-title>\n                    </v-list-item>\n                  </v-list>\n                </v-menu>\n                <v-btn icon=\"icon\">\n                  <v-icon large color=\"red\" @click=\"deletaPhase(i)\">mdi-minus-box</v-icon>\n                </v-btn>\n              </v-col>\n              <hr />\n            </v-row>\n          </v-container>\n        </v-form>\n      </v-card-text>\n      <v-card-actions>\n        <v-spacer></v-spacer>\n        <v-btn color=\"red\" height=\"49\" dark large @click=\"reset()\">\n          Cancelar\n          <v-icon dark right>mdi-close</v-icon>\n        </v-btn>\n        <v-btn color=\"success\" height=\"49\" dark large @click=\"validate()\">\n          Salvar\n          <v-icon dark right>mdi-content-save</v-icon>\n        </v-btn>\n      </v-card-actions>\n    </v-card>\n    <div class=\"text-center\">\n      <v-dialog v-model=\"dialog_alert\" width=\"500\">\n        <v-card>\n          <v-card-title class=\"headline red\" primary-title style=\"color:white;\">ALERTA!</v-card-title>\n          <v-card-text class=\"mt-3\" style=\"font-size: 1.3em;\">\n            Para criar um procedimento,  necessrio criar pelo menos uma\n            etapa.\n          </v-card-text>\n          <v-divider></v-divider>\n          <v-card-actions>\n            <v-spacer></v-spacer>\n            <v-btn color=\"primary\" text @click=\"dialog_alert = false\">Ok</v-btn>\n          </v-card-actions>\n        </v-card>\n      </v-dialog>\n    </div>\n  </v-container>\n</template>\n\n<script>\nimport Api from \"@/services/Api\";\nimport * as firebase from \"firebase\";\n\nexport default {\n  name: \"ProcedureDialog\",\n  props: [\"dialog\", \"procedure\", \"concept\", \"module\", \"domain\"],\n  data: () => ({\n    valid: true,\n    dialog_alert: false,\n    auxItemInfo: \"\",\n    phasesControl: [],\n    linkUrlRules: [(v) => !!v || \" necessrio inserir a url do seu link\"],\n    phasesControlRules: [\n      (v) =>\n        !!v ||\n        \" necessrio inserir algum contedo nessa etapa do procedimento\",\n    ],\n    procedureName: \"\",\n    procedureNameRules: [\n      (v) => !!v || \" necessrio descrever o nome do procedimento\",\n      (v) =>\n        (v && v.length <= 100) ||\n        \"Nome do procedimento deve ter no mximo 25 caracteres\",\n    ],\n    procedureDescription: \"\",\n    procedureDescriptionRules: [\n      (v) =>\n        !!v ||\n        \" necessrio inserir uma descrio do procedimento a ser inserido\",\n    ],\n    mobileMediasControl: [],\n    itemsMobileMedia: [\n      {\n        icon: \"mdi-file-image\",\n        name: \"Imagem\",\n      },\n      {\n        icon: \"mdi-file-video\",\n        name: \"Video\",\n      },\n      {\n        icon: \"mdi-file-music\",\n        name: \"Audio\",\n      },\n      {\n        icon: \"mdi-link-variant\",\n        name: \"Link\",\n      },\n    ],\n  }),\n  watch: {\n    dialog: function () {\n      this.getProcedure();\n    },\n  },\n  mounted: function () {\n    this.getProcedure();\n    this.$refs.form.resetValidation();\n  },\n  methods: {\n    async getProcedure() {\n      var vm = this;\n      this.$nextTick(function () {\n        vm.procedureName = vm.procedure.nameinformationitem;\n        vm.procedureDescription = vm.procedure.descriptioninformationitem;\n      });\n      this.phasesControl = [];\n      this.mobileMediasControl = [];\n      if (this.procedure !== \"\") {\n        this.procedure.phaseprocedures.forEach(async function (\n          phase,\n          indexPhase\n        ) {\n          await vm.phasesControl.push({\n            description: phase.description,\n            mobileMedias: [],\n            url: phase.url,\n          });\n          if (phase.mobilemedias) {\n            await phase.mobilemedias.forEach(async function (\n              elementMobile,\n              indexMobile\n            ) {\n              if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"1\") {\n                vm.getSrcImagePhases(\n                  indexPhase,\n                  indexMobile,\n                  elementMobile.path,\n                  elementMobile.namefile\n                );\n                await vm.phasesControl[indexPhase].mobileMedias.push({\n                  type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n                  object: null,\n                  resolution: elementMobile.resolution,\n                  path: elementMobile.path,\n                  namefile: elementMobile.namefile,\n                  url: elementMobile.url,\n                });\n              } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"2\") {\n                vm.getSrcVideoQuestions(\n                  indexPhase,\n                  indexMobile,\n                  elementMobile.path,\n                  elementMobile.namefile\n                );\n                await vm.phasesControl[indexPhase].mobileMedias.push({\n                  type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n                  object: null,\n                  resolution: elementMobile.resolution,\n                  time: elementMobile.time,\n                  path: elementMobile.path,\n                  namefile: elementMobile.namefile,\n                  url: elementMobile.url,\n                });\n              } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"3\") {\n                vm.getSrcAudioQuestions(\n                  indexPhase,\n                  indexMobile,\n                  elementMobile.path,\n                  elementMobile.namefile\n                );\n                await vm.phasesControl[indexPhase].mobileMedias.push({\n                  type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n                  object: null,\n                  path: elementMobile.path,\n                  namefile: elementMobile.namefile,\n                  url: elementMobile.url,\n                });\n              } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"5\") {\n                await vm.phasesControl[indexPhase].mobileMedias.push({\n                  type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n                  object: elementMobile.urllink,\n                  url: elementMobile.url,\n                });\n              }\n            });\n          }\n        });\n\n        await this.procedure.mobilemedias.forEach(async function (\n          elementMobile,\n          indexMobile\n        ) {\n          if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"1\") {\n            vm.getSrcImage(\n              indexMobile,\n              elementMobile.path,\n              elementMobile.namefile\n            );\n            await vm.mobileMediasControl.push({\n              type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n              object: null,\n              resolution: elementMobile.resolution,\n              path: elementMobile.path,\n              namefile: elementMobile.namefile,\n              url: elementMobile.url,\n            });\n          } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"2\") {\n            vm.getSrcVideo(\n              indexMobile,\n              elementMobile.path,\n              elementMobile.namefile\n            );\n            await vm.mobileMediasControl.push({\n              type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n              object: null,\n              resolution: elementMobile.resolution,\n              time: elementMobile.time,\n              path: elementMobile.path,\n              namefile: elementMobile.namefile,\n              url: elementMobile.url,\n            });\n          } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"3\") {\n            vm.getSrcAudio(\n              indexMobile,\n              elementMobile.path,\n              elementMobile.namefile\n            );\n            await vm.mobileMediasControl.push({\n              type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n              object: null,\n              path: elementMobile.path,\n              namefile: elementMobile.namefile,\n              url: elementMobile.url,\n            });\n          } else if (elementMobile.fk_idmediatype.split(\"/\")[4] === \"5\") {\n            await vm.mobileMediasControl.push({\n              type: parseInt(elementMobile.fk_idmediatype.split(\"/\")[4]),\n              object: elementMobile.urllink,\n              url: elementMobile.url,\n            });\n          }\n        });\n      }\n    },\n    async altera_Cria_Procedimento() {\n      var vm = this;\n      if (this.procedure === \"\") {\n        await Api()\n          .post(`/informationitem/`, {\n            nameinformationitem: this.procedureName,\n            descriptioninformationitem: this.procedureDescription,\n            fk_informationitemtype: `/informationitemtype/4/`,\n            fk_idconcept: this.concept.url,\n            visible: true,\n          })\n          .then(async function (resposta) {\n            vm.auxItemInfo = resposta.data.url;\n            var auxPath = \"\";\n            if (vm.mobileMediasControl) {\n              await vm.mobileMediasControl.forEach(async (mobilemedia) => {\n                if (mobilemedia.url) {\n                  if (mobilemedia.type !== 5) {\n                    firebase\n                      .storage()\n                      .ref()\n                      .child(mobilemedia.path)\n                      .put(mobilemedia.object);\n                  }\n                } else {\n                  auxPath =\n                    vm.domain.idknowledgedomain.toString() +\n                    \"/\" +\n                    (await setTimeout(async function () {\n                      await Date.now().toString();\n                    }, 1));\n                  if (mobilemedia.type !== 5) {\n                    firebase\n                      .storage()\n                      .ref()\n                      .child(auxPath)\n                      .put(mobilemedia.object);\n\n                    mobilemedia.path = auxPath;\n                  }\n                }\n              });\n            }\n            if (vm.mobileMediasControl) {\n              var i = 0;\n              await vm.mobileMediasControl.forEach(async function (\n                mobilemedia,\n                indexmobile\n              ) {\n                /* DANDO PUT NOS MOBILEMEDIAS QUE POSSUEM URL*/\n                if (mobilemedia.url) {\n                  if (mobilemedia.type === 1) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Imagem \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.namefile,\n                      description:\n                        \"Imagem \" +\n                        (indexmobile + 1) +\n                        \" \" +\n                        resposta.data.label,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 2) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Video \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.namefile,\n                      description: null,\n                      time: mobilemedia.time,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 3) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Audio \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: null,\n                      namefile: mobilemedia.namefile,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 5) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Link \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: null,\n                      resolution: null,\n                      namefile: null,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: mobilemedia.object,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  }\n                } else {\n                  /* DANDO POST NOS MOBILEMEDIAS QUE NO POSSUEM URL*/\n                  console.log(mobilemedia);\n                  if (mobilemedia.type === 1) {\n                    console.log(\"asdfsdfsd\");\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Imagem \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description:\n                        \"Imagem \" +\n                        (indexmobile + 1) +\n                        \" \" +\n                        resposta.data.label,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 2) {\n                    console.log(\"i\", i);\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Video \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description: null,\n                      time: mobilemedia.time,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 3) {\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Audio \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: null,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 5) {\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Link \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: null,\n                      resolution: null,\n                      namefile: null,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: mobilemedia.object,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                    });\n                  }\n                }\n              });\n            }\n          });\n      } else {\n        await Api()\n          .put(`/informationitem/` + this.procedure.idinformationitem + `/`, {\n            nameinformationitem: this.procedureName,\n            descriptioninformationitem: this.procedureDescription,\n            fk_informationitemtype: `/informationitemtype/4/`,\n            fk_idconcept: this.concept.url,\n          })\n          .then(async function (resposta) {\n            vm.auxItemInfo = resposta.data.url;\n            var auxPath = \"\";\n            if (vm.mobileMediasControl) {\n              await vm.mobileMediasControl.forEach(async (mobilemedia) => {\n                if (mobilemedia.url) {\n                  if (mobilemedia.type !== 5) {\n                    firebase\n                      .storage()\n                      .ref()\n                      .child(mobilemedia.path)\n                      .put(mobilemedia.object);\n                  }\n                } else {\n                  auxPath =\n                    vm.domain.idknowledgedomain.toString() +\n                    \"/\" +\n                    (await setTimeout(async function () {\n                      await Date.now().toString();\n                    }, 1));\n                  if (mobilemedia.type !== 5) {\n                    firebase\n                      .storage()\n                      .ref()\n                      .child(auxPath)\n                      .put(mobilemedia.object);\n\n                    mobilemedia.path = auxPath;\n                  }\n                }\n              });\n            }\n            if (vm.mobileMediasControl) {\n              var i = 0;\n              await vm.mobileMediasControl.forEach(async function (\n                mobilemedia,\n                indexmobile\n              ) {\n                /* DANDO PUT NOS MOBILEMEDIAS QUE POSSUEM URL*/\n                console.log(mobilemedia);\n                if (mobilemedia.url) {\n                  if (mobilemedia.type === 1) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Imagem \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.namefile,\n                      description:\n                        \"Imagem \" +\n                        (indexmobile + 1) +\n                        \" \" +\n                        resposta.data.label,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_informationitem: resposta.data.url,\n                      visible: true,\n                    });\n                  } else if (mobilemedia.type === 2) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Video \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.namefile,\n                      description: null,\n                      time: mobilemedia.time,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 3) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Audio \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: null,\n                      namefile: mobilemedia.namefile,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 5) {\n                    await Api().put(mobilemedia.url, {\n                      label: \"Link \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: null,\n                      resolution: null,\n                      namefile: null,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: mobilemedia.object,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  }\n                } else {\n                  /* DANDO POST NOS MOBILEMEDIAS QUE NO POSSUEM URL*/\n                  if (mobilemedia.type === 1) {\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Imagem \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description:\n                        \"Imagem \" +\n                        (indexmobile + 1) +\n                        \" \" +\n                        resposta.data.label,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 2) {\n                    console.log(\"i\", i);\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Video \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: mobilemedia.resolution,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description: null,\n                      time: mobilemedia.time,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 3) {\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Audio \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: mobilemedia.path,\n                      resolution: null,\n                      namefile: mobilemedia.path.split(\"/\")[1],\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: null,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  } else if (mobilemedia.type === 5) {\n                    await Api().post(`/mobilemedia/`, {\n                      label: \"Link \" + (indexmobile + 1),\n                      fk_idmediatype: \"/mediatype/\" + mobilemedia.type + \"/\",\n                      path: null,\n                      resolution: null,\n                      namefile: null,\n                      description: null,\n                      time: null,\n                      textfull: null,\n                      textshort: null,\n                      urllink: mobilemedia.object,\n                      difficultyLevel: null,\n                      learningStyle: null,\n                      fk_idinstructionalelement: resposta.data.url,\n                    });\n                  }\n                }\n              });\n            }\n          });\n      }\n    },\n    async altera_Cria_Fases() {\n      var vm = this;\n      var auxPathPhases = \"\";\n      this.phasesControl.forEach(async function (phase) {\n        if (phase.mobileMedias.length > 0) {\n          await phase.mobileMedias.forEach(async (mobilemedia) => {\n            if (mobilemedia.url) {\n              if (mobilemedia.type !== 5) {\n                firebase\n                  .storage()\n                  .ref()\n                  .child(mobilemedia.path)\n                  .put(mobilemedia.object);\n              }\n            } else {\n              auxPathPhases =\n                vm.domain.idknowledgedomain.toString() +\n                \"/\" +\n                (await setTimeout(async function () {\n                  await Date.now().toString();\n                }, 1));\n              if (mobilemedia.type !== 5) {\n                firebase\n                  .storage()\n                  .ref()\n                  .child(auxPathPhases)\n                  .put(mobilemedia.object);\n\n                mobilemedia.path = auxPathPhases;\n              }\n            }\n          });\n        }\n      });\n      this.phasesControl.forEach(async function (phase, index) {\n        if (phase.url === null) {\n          await Api()\n            .post(`/phaseprocedure/`, {\n              order: index + 1,\n              description: phase.description,\n              fk_informationitem: vm.auxItemInfo,\n            })\n            .then(async function (resposta) {\n              if (phase.mobileMedias.length > 0) {\n                await phase.mobileMedias.forEach(async function (\n                  elementMobile,\n                  indexMobile\n                ) {\n                  if (elementMobile.url) {\n                    if (elementMobile.type === 1) {\n                      await Api().put(elementMobile.url, {\n                        label: \"Imagem \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: elementMobile.resolution,\n                        namefile: elementMobile.namefile,\n                        description:\n                          \"Imagem \" +\n                          (indexMobile + 1) +\n                          \" Fase\" +\n                          resposta.data.orderquestion,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 2) {\n                      await Api().put(elementMobile.url, {\n                        label: \"Video \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: elementMobile.resolution,\n                        namefile: elementMobile.namefile,\n                        description: null,\n                        time: elementMobile.time,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 3) {\n                      await Api().put(elementMobile.url, {\n                        label: \"Audio \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: null,\n                        namefile: elementMobile.namefile,\n                        description: null,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 5) {\n                      await Api().put(elementMobile.url, {\n                        label: \"Link \" + (indexMobile + 1) + vm.i++ * 0,\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: null,\n                        resolution: null,\n                        namefile: null,\n                        description: null,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: elementMobile.object,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    }\n                  } else {\n                    if (elementMobile.type === 1) {\n                      await Api().post(`/mobilemedia/`, {\n                        label: \"Imagem \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: elementMobile.resolution,\n                        namefile: elementMobile.path.split(\"/\")[1],\n                        description:\n                          \"Imagem \" +\n                          (indexMobile + 1) +\n                          \" Fase\" +\n                          resposta.data.orderquestion,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 2) {\n                      await Api().post(`/mobilemedia/`, {\n                        label: \"Video \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: elementMobile.resolution,\n                        namefile: elementMobile.path.split(\"/\")[1],\n                        description: null,\n                        time: elementMobile.time,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 3) {\n                      await Api().post(`/mobilemedia/`, {\n                        label: \"Audio \" + (indexMobile + 1),\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: elementMobile.path,\n                        resolution: null,\n                        namefile: elementMobile.path.split(\"/\")[1],\n                        description: null,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: null,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    } else if (elementMobile.type === 5) {\n                      await Api().post(`/mobilemedia/`, {\n                        label: \"Link \" + (indexMobile + 1) + vm.i++ * 0,\n                        fk_idmediatype:\n                          \"/mediatype/\" + elementMobile.type + \"/\",\n                        path: null,\n                        resolution: null,\n                        namefile: null,\n                        description: null,\n                        time: null,\n                        textfull: null,\n                        textshort: null,\n                        urllink: elementMobile.object,\n                        difficultyLevel: null,\n                        learningStyle: null,\n                        fk_idphaseprocedure: resposta.data.url,\n                      });\n                    }\n                  }\n                });\n              }\n            });\n        } else {\n          await Api().put(phase.url, {\n            order: index + 1,\n            description: phase.description,\n            fk_informationitem: vm.auxItemInfo,\n          });\n        }\n      });\n    },\n\n    async validate() {\n      if (this.$refs.form.validate()) {\n        if (this.phasesControl.length > 0) {\n          var i = this.phasesControl.length;\n          await this.altera_Cria_Procedimento();\n          await this.altera_Cria_Fases();\n          this.phasesControl = [];\n          await this.$emit(\"procedureclose\", \"save\", i);\n        } else {\n          this.dialog_alert = true;\n        }\n      }\n    },\n    reset() {\n      this.$refs.form.reset();\n      this.phasesControl = [];\n      this.$emit(\"procedureclose\", \"close\");\n    },\n    addPhase() {\n      this.phasesControl.push({\n        description: null,\n        mobileMedias: [],\n        url: null,\n      });\n    },\n    async deletaPhase(idPhase) {\n      if (this.phasesControl[idPhase].url !== null) {\n        await Api().delete(this.phasesControl[idPhase].url);\n        await this.altera_Cria_Fases();\n      }\n      if (idPhase == 0) {\n        this.phasesControl.shift();\n      } else {\n        this.phasesControl.splice(idPhase, 1);\n      }\n    },\n    addMobileMedia(mobileMediaType) {\n      if (mobileMediaType === 1) {\n        this.mobileMediasControl.push({\n          type: mobileMediaType,\n          object: null,\n          resolution: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 2) {\n        this.mobileMediasControl.push({\n          type: mobileMediaType,\n          object: null,\n          resolution: null,\n          time: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 3) {\n        this.mobileMediasControl.push({\n          type: mobileMediaType,\n          object: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 4) {\n        this.mobileMediasControl.push({\n          type: mobileMediaType + 1,\n          object: null,\n          url: null,\n        });\n      }\n    },\n    async deleteMobileMedia(idMobileMedia) {\n      if (this.mobileMediasControl[idMobileMedia].url) {\n        if (this.mobileMediasControl[idMobileMedia].type !== 5) {\n          await firebase\n            .storage()\n            .ref()\n            .child(this.mobileMediasControl[idMobileMedia].path)\n            .delete();\n        }\n        await Api().delete(this.mobileMediasControl[idMobileMedia].url);\n      }\n      if (idMobileMedia == 0) {\n        this.mobileMediasControl.shift();\n      } else {\n        this.mobileMediasControl.splice(idMobileMedia, 1);\n      }\n    },\n    atualizaMeta() {\n      if (this.mobileMediasControl.length > 0) {\n        this.mobileMediasControl.forEach((mobilemedia) => {\n          if (mobilemedia.object && !mobilemedia.url) {\n            if (mobilemedia.type === 1) {\n              var img = new Image();\n              img.src = URL.createObjectURL(mobilemedia.object);\n              img.onload = function () {\n                mobilemedia.resolution = img.width + \"X\" + img.height;\n              };\n            } else if (mobilemedia.type === 2) {\n              var video = document.createElement(\"video\");\n              var source = document.createElement(\"source\");\n              source.setAttribute(\n                \"src\",\n                URL.createObjectURL(mobilemedia.object)\n              );\n              video.appendChild(source);\n              video.oncanplay = function () {\n                mobilemedia.resolution =\n                  video.videoWidth + \"X\" + video.videoHeight;\n                mobilemedia.time = video.duration;\n              };\n            }\n          }\n        });\n      }\n    },\n    async getSrcImage(indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewImageSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              // vm.auxGetSrc.push(file);\n              vm.atualizaObj(file, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n    async getSrcVideo(indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewVideoSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              // vm.auxGetSrc.push(file);\n              vm.atualizaObj(file, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n    async getSrcAudio(indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewAudioSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              // vm.auxGetSrc.push(file);\n              vm.atualizaObj(file, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n    atualizaObj(file, indexMobile) {\n      this.mobileMediasControl[indexMobile].object = file;\n    },\n    addMobileMediaPhase(idPhase, mobileMediaType) {\n      if (mobileMediaType === 1) {\n        this.phasesControl[idPhase].mobileMedias.push({\n          type: mobileMediaType,\n          object: null,\n          resolution: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 2) {\n        this.phasesControl[idPhase].mobileMedias.push({\n          type: mobileMediaType,\n          object: null,\n          resolution: null,\n          time: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 3) {\n        this.phasesControl[idPhase].mobileMedias.push({\n          type: mobileMediaType,\n          object: null,\n          path: null,\n          namefile: null,\n          url: null,\n        });\n      } else if (mobileMediaType === 4) {\n        this.phasesControl[idPhase].mobileMedias.push({\n          type: mobileMediaType + 1,\n          object: null,\n          url: null,\n        });\n      }\n    },\n    async deleteMobileMediaPhase(idPhase, idMobileMedia) {\n      if (this.phasesControl[idPhase].mobileMedias[idMobileMedia].url) {\n        if (\n          this.phasesControl[idPhase].mobileMedias[idMobileMedia].type !== 5\n        ) {\n          await firebase\n            .storage()\n            .ref()\n            .child(this.phasesControl[idPhase].mobileMedias[idMobileMedia].path)\n            .delete();\n        }\n        await Api().delete(\n          this.phasesControl[idPhase].mobileMedias[idMobileMedia].url\n        );\n      }\n      if (idMobileMedia == 0) {\n        this.phasesControl[idPhase].mobileMedias.shift();\n      } else {\n        this.phasesControl[idPhase].mobileMedias.splice(idMobileMedia, 1);\n      }\n    },\n    atualizaMetaPhases() {\n      if (this.phasesControl.length > 0) {\n        this.phasesControl.forEach((phase) => {\n          if (phase.mobileMedias) {\n            phase.mobileMedias.forEach((mobilemedia) => {\n              if (mobilemedia.object && !mobilemedia.url) {\n                if (mobilemedia.type === 1) {\n                  var img = new Image();\n                  img.src = URL.createObjectURL(mobilemedia.object);\n                  img.onload = function () {\n                    mobilemedia.resolution = img.width + \"X\" + img.height;\n                  };\n                } else if (mobilemedia.type === 2) {\n                  var video = document.createElement(\"video\");\n                  var source = document.createElement(\"source\");\n                  source.setAttribute(\n                    \"src\",\n                    URL.createObjectURL(mobilemedia.object)\n                  );\n                  video.appendChild(source);\n                  video.oncanplay = function () {\n                    mobilemedia.resolution =\n                      video.videoWidth + \"X\" + video.videoHeight;\n                    mobilemedia.time = video.duration;\n                  };\n                }\n              }\n            });\n          }\n        });\n      }\n    },\n    atualizaObjPhases(file, indexPhase, indexMobile) {\n      this.phasesControl[indexPhase].mobileMedias[indexMobile].object = file;\n    },\n    async getSrcImagePhases(indexPhase, indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewImageSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              /*vm.auxGetSrcPhases.push(file);*/\n              vm.atualizaObjPhases(file, indexPhase, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n    async getSrcVideoPhases(indexPhase, indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewVideoSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              // vm.auxGetSrcPhases.push(file);\n              vm.atualizaObjPhases(file, indexPhase, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n    async getSrcAudioPhases(indexPhase, indexMobile, path, namefile) {\n      /*var obj = {};*/\n      if (path) {\n        var vm = this;\n        await firebase\n          .storage()\n          .ref(path)\n          .getDownloadURL()\n          .then(function (url) {\n            /*vm.viewAudioSrc = url;*/\n            var xhr = new XMLHttpRequest();\n            xhr.responseType = \"blob\";\n            xhr.onload = function () {\n              var blob = xhr.response;\n              var file = new File([blob], namefile, {\n                type: blob.type,\n              });\n              // vm.auxGetSrcPhases.push(file);\n              vm.atualizaObjPhases(file, indexPhase, indexMobile);\n            };\n            xhr.open(\"GET\", url);\n            xhr.send();\n          });\n      }\n    },\n  },\n};\n</script>\n"]}]}